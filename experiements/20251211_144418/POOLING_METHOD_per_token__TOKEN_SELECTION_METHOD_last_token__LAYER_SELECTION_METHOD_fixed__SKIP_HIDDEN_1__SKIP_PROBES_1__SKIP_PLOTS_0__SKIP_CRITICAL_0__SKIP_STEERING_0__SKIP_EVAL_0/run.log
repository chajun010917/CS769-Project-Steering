=== Step 1: Using manually reviewed triples: ./artifacts/manual_review/12062025_human_review.json ===
=== Step 2: Skipping hidden state capture (SKIP_HIDDEN=1) ===
=== Step 3: Skipping probe computation (SKIP_PROBES=1) ===
=== Step 4: Generating visualizations ===
  Plotting layer 26...
2025-12-11 14:44:19,428 | INFO | Loading PCA data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer26_pca_data.npz
2025-12-11 14:44:19,431 | INFO | PCA DP filter retained 1336 samples
2025-12-11 14:44:19,436 | INFO | Applying DP tail filter to PCA data (retained 446 samples).
2025-12-11 14:44:19,719 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer26_pca_clusters_dp.png
2025-12-11 14:44:19,719 | INFO | Loading UMAP data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer26_umap_data.npz
2025-12-11 14:44:19,720 | INFO | UMAP DP filter retained 1336 samples
2025-12-11 14:44:19,720 | INFO | Applying DP tail filter to UMAP data (retained 446 samples).
2025-12-11 14:44:19,971 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer26_umap_clusters_dp.png
2025-12-11 14:44:19,971 | INFO | All plots saved to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token
  Plotting layer 27...
2025-12-11 14:44:20,582 | INFO | Loading PCA data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer27_pca_data.npz
2025-12-11 14:44:20,584 | INFO | PCA DP filter retained 1336 samples
2025-12-11 14:44:20,589 | INFO | Applying DP tail filter to PCA data (retained 446 samples).
2025-12-11 14:44:20,871 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer27_pca_clusters_dp.png
2025-12-11 14:44:20,871 | INFO | Loading UMAP data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer27_umap_data.npz
2025-12-11 14:44:20,872 | INFO | UMAP DP filter retained 1336 samples
2025-12-11 14:44:20,872 | INFO | Applying DP tail filter to UMAP data (retained 446 samples).
2025-12-11 14:44:21,129 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer27_umap_clusters_dp.png
2025-12-11 14:44:21,129 | INFO | All plots saved to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token
  Plotting layer 28...
2025-12-11 14:44:21,749 | INFO | Loading PCA data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer28_pca_data.npz
2025-12-11 14:44:21,751 | INFO | PCA DP filter retained 1336 samples
2025-12-11 14:44:21,756 | INFO | Applying DP tail filter to PCA data (retained 446 samples).
2025-12-11 14:44:22,041 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer28_pca_clusters_dp.png
2025-12-11 14:44:22,041 | INFO | Loading UMAP data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer28_umap_data.npz
2025-12-11 14:44:22,042 | INFO | UMAP DP filter retained 1336 samples
2025-12-11 14:44:22,042 | INFO | Applying DP tail filter to UMAP data (retained 446 samples).
2025-12-11 14:44:22,287 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer28_umap_clusters_dp.png
2025-12-11 14:44:22,287 | INFO | All plots saved to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token
  Plotting layer 29...
2025-12-11 14:44:22,929 | INFO | Loading PCA data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer29_pca_data.npz
2025-12-11 14:44:22,932 | INFO | PCA DP filter retained 1336 samples
2025-12-11 14:44:22,937 | INFO | Applying DP tail filter to PCA data (retained 446 samples).
2025-12-11 14:44:23,226 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer29_pca_clusters_dp.png
2025-12-11 14:44:23,227 | INFO | Loading UMAP data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer29_umap_data.npz
2025-12-11 14:44:23,227 | INFO | UMAP DP filter retained 1336 samples
2025-12-11 14:44:23,228 | INFO | Applying DP tail filter to UMAP data (retained 446 samples).
2025-12-11 14:44:23,468 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer29_umap_clusters_dp.png
2025-12-11 14:44:23,468 | INFO | All plots saved to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token
  Plotting layer 30...
2025-12-11 14:44:24,077 | INFO | Loading PCA data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer30_pca_data.npz
2025-12-11 14:44:24,079 | INFO | PCA DP filter retained 1336 samples
2025-12-11 14:44:24,085 | INFO | Applying DP tail filter to PCA data (retained 446 samples).
2025-12-11 14:44:24,386 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer30_pca_clusters_dp.png
2025-12-11 14:44:24,386 | INFO | Loading UMAP data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer30_umap_data.npz
2025-12-11 14:44:24,387 | INFO | UMAP DP filter retained 1336 samples
2025-12-11 14:44:24,387 | INFO | Applying DP tail filter to UMAP data (retained 446 samples).
2025-12-11 14:44:24,625 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer30_umap_clusters_dp.png
2025-12-11 14:44:24,625 | INFO | All plots saved to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token
  Plotting layer 31...
2025-12-11 14:44:25,224 | INFO | Loading PCA data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer31_pca_data.npz
2025-12-11 14:44:25,226 | INFO | PCA DP filter retained 1336 samples
2025-12-11 14:44:25,232 | INFO | Applying DP tail filter to PCA data (retained 446 samples).
2025-12-11 14:44:25,522 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer31_pca_clusters_dp.png
2025-12-11 14:44:25,522 | INFO | Loading UMAP data from /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/layer31_umap_data.npz
2025-12-11 14:44:25,523 | INFO | UMAP DP filter retained 1336 samples
2025-12-11 14:44:25,523 | INFO | Applying DP tail filter to UMAP data (retained 446 samples).
2025-12-11 14:44:25,788 | INFO | Saved cluster overlay to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/cluster_overlays_dp/layer31_umap_clusters_dp.png
2025-12-11 14:44:25,788 | INFO | All plots saved to /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token
=== Step 5: Analyzing critical token positions ===
  Analyzing critical tokens for layer 26...
2025-12-11 14:44:27,300 | INFO | Loading probe data from /nobackup/bdeka/huggingface_cache/artifacts/probe_data/layer26_probe_data.npz
2025-12-11 14:44:27,316 | INFO | Loaded 1336 tokens from layer 26
2025-12-11 14:44:27,316 | INFO | Validity flag found: 1336 valid, 0 invalid
2025-12-11 14:44:27,316 | INFO | DP alignment filter applied: 1336 of 1336 tokens retained
2025-12-11 14:44:27,320 | INFO | Using 1336 tokens after filtering.
2025-12-11 14:44:27,321 | INFO | Analyzing token contributions to PC2 separation...
2025-12-11 14:44:28,636 | INFO | PCA explained variance: PC1=0.756, PC2=0.020
2025-12-11 14:44:28,651 | INFO | Saved full results to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer26_critical_tokens.json
2025-12-11 14:44:29,077 | INFO | Saved PC2 distribution plot to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer26_pc2_distribution.png

================================================================================
Top 20 tokens with LOWEST PC2 scores (most wrong-like):
================================================================================
 1. [wrong] PC2=-13.925 pos=221 'Ġthe' (12192_mmlu_engineering)
 2. [wrong] PC2=-13.001 pos=227 'Ġis' (12192_mmlu_engineering)
 3. [wrong] PC2=-12.704 pos=166 'Ġa' (12192_mmlu_engineering)
 4. [right] PC2=-12.178 pos=191 'Ġthe' (12192_mmlu_engineering)
 5. [right] PC2=-11.467 pos=162 'A' (12192_mmlu_engineering)
 6. [wrong] PC2=-11.010 pos=114 'ĠA' (12192_mmlu_engineering)
 7. [right] PC2=-10.932 pos=428 'Ġbe' (11127_mmlu_philosophy)
 8. [right] PC2=-10.924 pos=136 'This' (12192_mmlu_engineering)
 9. [wrong] PC2=-10.919 pos=406 'Ġ"' (11127_mmlu_philosophy)
10. [wrong] PC2=-10.752 pos=107 'Ġa' (12192_mmlu_engineering)
11. [right] PC2=-10.695 pos=139 'Ġis' (12192_mmlu_engineering)
12. [wrong] PC2=-10.631 pos=254 'Ġthe' (12192_mmlu_engineering)
13. [wrong] PC2=-10.567 pos=238 'Ġthe' (12192_mmlu_engineering)
14. [wrong] PC2=-10.475 pos=203 'Ġto' (12192_mmlu_engineering)
15. [right] PC2=-10.443 pos=375 'Ġbe' (11127_mmlu_philosophy)
16. [wrong] PC2=-10.437 pos=201 'Ġthis' (12192_mmlu_engineering)
17. [right] PC2=-10.324 pos=211 'The' (12192_mmlu_engineering)
18. [wrong] PC2=-10.235 pos=356 'Ġbe' (11127_mmlu_philosophy)
19. [wrong] PC2=-10.107 pos=428 'China' (11127_mmlu_philosophy)
20. [right] PC2= -9.996 pos=207 'Ġbe' (12192_mmlu_engineering)

================================================================================
Top 20 tokens with HIGHEST PC2 scores (most right-like):
================================================================================
 1. [wrong] PC2= 16.460 pos= 49 'user' (12192_mmlu_engineering)
 2. [right] PC2= 16.453 pos= 49 'user' (12192_mmlu_engineering)
 3. [wrong] PC2= 16.452 pos= 49 'user' (11127_mmlu_philosophy)
 4. [right] PC2= 16.446 pos= 49 'user' (11127_mmlu_philosophy)
 5. [right] PC2= 15.973 pos= 51 'ĊĊ' (12192_mmlu_engineering)
 6. [wrong] PC2= 15.972 pos= 51 'ĊĊ' (12192_mmlu_engineering)
 7. [right] PC2= 15.968 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
 8. [wrong] PC2= 15.967 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
 9. [right] PC2= 15.793 pos= 31 'Ġassistant' (11127_mmlu_philosophy)
10. [wrong] PC2= 15.791 pos= 31 'Ġassistant' (12192_mmlu_engineering)
11. [wrong] PC2= 15.790 pos= 31 'Ġassistant' (11127_mmlu_philosophy)
12. [right] PC2= 15.788 pos= 31 'Ġassistant' (12192_mmlu_engineering)
13. [wrong] PC2= 15.635 pos= 23 '202' (11127_mmlu_philosophy)
14. [wrong] PC2= 15.634 pos= 21 'ĠJul' (11127_mmlu_philosophy)
15. [right] PC2= 15.634 pos= 23 '202' (11127_mmlu_philosophy)
16. [right] PC2= 15.628 pos= 21 'ĠJul' (11127_mmlu_philosophy)
17. [wrong] PC2= 15.628 pos= 21 'ĠJul' (12192_mmlu_engineering)
18. [right] PC2= 15.626 pos= 23 '202' (12192_mmlu_engineering)
19. [right] PC2= 15.626 pos= 21 'ĠJul' (12192_mmlu_engineering)
20. [wrong] PC2= 15.614 pos= 23 '202' (12192_mmlu_engineering)

================================================================================
Analysis complete!
================================================================================
  Analyzing critical tokens for layer 27...
2025-12-11 14:44:30,761 | INFO | Loading probe data from /nobackup/bdeka/huggingface_cache/artifacts/probe_data/layer27_probe_data.npz
2025-12-11 14:44:30,776 | INFO | Loaded 1336 tokens from layer 27
2025-12-11 14:44:30,776 | INFO | Validity flag found: 1336 valid, 0 invalid
2025-12-11 14:44:30,777 | INFO | DP alignment filter applied: 1336 of 1336 tokens retained
2025-12-11 14:44:30,781 | INFO | Using 1336 tokens after filtering.
2025-12-11 14:44:30,781 | INFO | Analyzing token contributions to PC2 separation...
2025-12-11 14:44:32,321 | INFO | PCA explained variance: PC1=0.719, PC2=0.023
2025-12-11 14:44:32,337 | INFO | Saved full results to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer27_critical_tokens.json
2025-12-11 14:44:32,733 | INFO | Saved PC2 distribution plot to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer27_pc2_distribution.png

================================================================================
Top 20 tokens with LOWEST PC2 scores (most wrong-like):
================================================================================
 1. [wrong] PC2=-14.910 pos=221 'Ġthe' (12192_mmlu_engineering)
 2. [wrong] PC2=-13.909 pos=166 'Ġa' (12192_mmlu_engineering)
 3. [right] PC2=-13.088 pos=428 'Ġbe' (11127_mmlu_philosophy)
 4. [wrong] PC2=-12.699 pos=227 'Ġis' (12192_mmlu_engineering)
 5. [right] PC2=-12.308 pos=191 'Ġthe' (12192_mmlu_engineering)
 6. [wrong] PC2=-12.292 pos=203 'Ġto' (12192_mmlu_engineering)
 7. [wrong] PC2=-12.248 pos=428 'China' (11127_mmlu_philosophy)
 8. [right] PC2=-12.152 pos=375 'Ġbe' (11127_mmlu_philosophy)
 9. [wrong] PC2=-11.934 pos=114 'ĠA' (12192_mmlu_engineering)
10. [wrong] PC2=-11.849 pos=356 'Ġbe' (11127_mmlu_philosophy)
11. [right] PC2=-11.793 pos=324 'Ġimports' (11127_mmlu_philosophy)
12. [wrong] PC2=-11.678 pos=107 'Ġa' (12192_mmlu_engineering)
13. [wrong] PC2=-11.659 pos=201 'Ġthis' (12192_mmlu_engineering)
14. [wrong] PC2=-11.611 pos=308 ''s' (11127_mmlu_philosophy)
15. [wrong] PC2=-11.467 pos=411 'Ġsupply' (11127_mmlu_philosophy)
16. [wrong] PC2=-11.164 pos=238 'Ġthe' (12192_mmlu_engineering)
17. [right] PC2=-11.154 pos=335 'China' (11127_mmlu_philosophy)
18. [right] PC2=-11.146 pos=387 'China' (11127_mmlu_philosophy)
19. [wrong] PC2=-11.112 pos=303 'Ġfor' (11127_mmlu_philosophy)
20. [wrong] PC2=-11.111 pos=362 'Ġimports' (11127_mmlu_philosophy)

================================================================================
Top 20 tokens with HIGHEST PC2 scores (most right-like):
================================================================================
 1. [right] PC2= 17.238 pos= 31 'Ġassistant' (11127_mmlu_philosophy)
 2. [wrong] PC2= 17.236 pos= 31 'Ġassistant' (11127_mmlu_philosophy)
 3. [wrong] PC2= 17.235 pos= 31 'Ġassistant' (12192_mmlu_engineering)
 4. [right] PC2= 17.230 pos= 31 'Ġassistant' (12192_mmlu_engineering)
 5. [wrong] PC2= 17.004 pos= 51 'ĊĊ' (12192_mmlu_engineering)
 6. [right] PC2= 17.003 pos= 51 'ĊĊ' (12192_mmlu_engineering)
 7. [right] PC2= 17.001 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
 8. [wrong] PC2= 16.997 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
 9. [wrong] PC2= 16.931 pos= 49 'user' (12192_mmlu_engineering)
10. [right] PC2= 16.922 pos= 49 'user' (12192_mmlu_engineering)
11. [wrong] PC2= 16.919 pos= 49 'user' (11127_mmlu_philosophy)
12. [right] PC2= 16.916 pos= 49 'user' (11127_mmlu_philosophy)
13. [wrong] PC2= 16.456 pos= 23 '202' (11127_mmlu_philosophy)
14. [right] PC2= 16.455 pos= 23 '202' (11127_mmlu_philosophy)
15. [right] PC2= 16.444 pos= 23 '202' (12192_mmlu_engineering)
16. [wrong] PC2= 16.437 pos= 23 '202' (12192_mmlu_engineering)
17. [right] PC2= 15.653 pos= 25 'ĊĊ' (11127_mmlu_philosophy)
18. [right] PC2= 15.642 pos= 25 'ĊĊ' (12192_mmlu_engineering)
19. [wrong] PC2= 15.635 pos= 25 'ĊĊ' (11127_mmlu_philosophy)
20. [wrong] PC2= 15.634 pos= 25 'ĊĊ' (12192_mmlu_engineering)

================================================================================
Analysis complete!
================================================================================
  Analyzing critical tokens for layer 28...
2025-12-11 14:44:34,447 | INFO | Loading probe data from /nobackup/bdeka/huggingface_cache/artifacts/probe_data/layer28_probe_data.npz
2025-12-11 14:44:34,466 | INFO | Loaded 1336 tokens from layer 28
2025-12-11 14:44:34,466 | INFO | Validity flag found: 1336 valid, 0 invalid
2025-12-11 14:44:34,467 | INFO | DP alignment filter applied: 1336 of 1336 tokens retained
2025-12-11 14:44:34,471 | INFO | Using 1336 tokens after filtering.
2025-12-11 14:44:34,471 | INFO | Analyzing token contributions to PC2 separation...
2025-12-11 14:44:36,032 | INFO | PCA explained variance: PC1=0.679, PC2=0.027
2025-12-11 14:44:36,046 | INFO | Saved full results to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer28_critical_tokens.json
2025-12-11 14:44:36,432 | INFO | Saved PC2 distribution plot to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer28_pc2_distribution.png

================================================================================
Top 20 tokens with LOWEST PC2 scores (most wrong-like):
================================================================================
 1. [wrong] PC2=-14.213 pos=221 'Ġthe' (12192_mmlu_engineering)
 2. [right] PC2=-13.689 pos=428 'Ġbe' (11127_mmlu_philosophy)
 3. [wrong] PC2=-13.491 pos=166 'Ġa' (12192_mmlu_engineering)
 4. [right] PC2=-13.279 pos=324 'Ġimports' (11127_mmlu_philosophy)
 5. [wrong] PC2=-13.106 pos=411 'Ġsupply' (11127_mmlu_philosophy)
 6. [wrong] PC2=-12.995 pos=428 'China' (11127_mmlu_philosophy)
 7. [wrong] PC2=-12.900 pos=360 'If' (11127_mmlu_philosophy)
 8. [wrong] PC2=-12.787 pos=308 ''s' (11127_mmlu_philosophy)
 9. [right] PC2=-12.759 pos=375 'Ġbe' (11127_mmlu_philosophy)
10. [right] PC2=-12.660 pos=322 'if' (11127_mmlu_philosophy)
11. [wrong] PC2=-12.570 pos=410 ''t' (11127_mmlu_philosophy)
12. [wrong] PC2=-12.558 pos=362 'Ġimports' (11127_mmlu_philosophy)
13. [wrong] PC2=-12.484 pos=349 'Ġfor' (11127_mmlu_philosophy)
14. [wrong] PC2=-12.425 pos=365 'Ġthen' (11127_mmlu_philosophy)
15. [right] PC2=-12.405 pos=335 'China' (11127_mmlu_philosophy)
16. [wrong] PC2=-12.393 pos=356 'Ġbe' (11127_mmlu_philosophy)
17. [right] PC2=-12.359 pos=344 't' (11127_mmlu_philosophy)
18. [wrong] PC2=-12.309 pos=406 'Ġ"' (11127_mmlu_philosophy)
19. [right] PC2=-12.134 pos=327 'Ġthen' (11127_mmlu_philosophy)
20. [wrong] PC2=-12.054 pos=227 'Ġis' (12192_mmlu_engineering)

================================================================================
Top 20 tokens with HIGHEST PC2 scores (most right-like):
================================================================================
 1. [wrong] PC2= 19.749 pos= 23 '202' (11127_mmlu_philosophy)
 2. [right] PC2= 19.747 pos= 23 '202' (12192_mmlu_engineering)
 3. [right] PC2= 19.746 pos= 23 '202' (11127_mmlu_philosophy)
 4. [wrong] PC2= 19.733 pos= 23 '202' (12192_mmlu_engineering)
 5. [wrong] PC2= 19.344 pos= 31 'Ġassistant' (11127_mmlu_philosophy)
 6. [right] PC2= 19.343 pos= 31 'Ġassistant' (11127_mmlu_philosophy)
 7. [right] PC2= 19.341 pos= 31 'Ġassistant' (12192_mmlu_engineering)
 8. [wrong] PC2= 19.341 pos= 31 'Ġassistant' (12192_mmlu_engineering)
 9. [wrong] PC2= 19.034 pos= 51 'ĊĊ' (12192_mmlu_engineering)
10. [wrong] PC2= 19.029 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
11. [right] PC2= 19.027 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
12. [right] PC2= 19.024 pos= 51 'ĊĊ' (12192_mmlu_engineering)
13. [wrong] PC2= 18.786 pos= 12 'Ġ' (11127_mmlu_philosophy)
14. [wrong] PC2= 18.783 pos= 12 'Ġ' (12192_mmlu_engineering)
15. [right] PC2= 18.779 pos= 12 'Ġ' (11127_mmlu_philosophy)
16. [right] PC2= 18.778 pos= 12 'Ġ' (12192_mmlu_engineering)
17. [wrong] PC2= 18.341 pos= 21 'ĠJul' (11127_mmlu_philosophy)
18. [wrong] PC2= 18.331 pos= 21 'ĠJul' (12192_mmlu_engineering)
19. [right] PC2= 18.326 pos= 21 'ĠJul' (12192_mmlu_engineering)
20. [right] PC2= 18.321 pos= 21 'ĠJul' (11127_mmlu_philosophy)

================================================================================
Analysis complete!
================================================================================
  Analyzing critical tokens for layer 29...
2025-12-11 14:44:38,114 | INFO | Loading probe data from /nobackup/bdeka/huggingface_cache/artifacts/probe_data/layer29_probe_data.npz
2025-12-11 14:44:38,129 | INFO | Loaded 1336 tokens from layer 29
2025-12-11 14:44:38,130 | INFO | Validity flag found: 1336 valid, 0 invalid
2025-12-11 14:44:38,130 | INFO | DP alignment filter applied: 1336 of 1336 tokens retained
2025-12-11 14:44:38,135 | INFO | Using 1336 tokens after filtering.
2025-12-11 14:44:38,135 | INFO | Analyzing token contributions to PC2 separation...
2025-12-11 14:44:39,938 | INFO | PCA explained variance: PC1=0.634, PC2=0.029
2025-12-11 14:44:39,953 | INFO | Saved full results to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer29_critical_tokens.json
2025-12-11 14:44:40,393 | INFO | Saved PC2 distribution plot to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer29_pc2_distribution.png

================================================================================
Top 20 tokens with LOWEST PC2 scores (most wrong-like):
================================================================================
 1. [wrong] PC2=-16.333 pos=360 'If' (11127_mmlu_philosophy)
 2. [wrong] PC2=-15.977 pos=365 'Ġthen' (11127_mmlu_philosophy)
 3. [right] PC2=-15.977 pos=322 'if' (11127_mmlu_philosophy)
 4. [right] PC2=-15.540 pos=327 'Ġthen' (11127_mmlu_philosophy)
 5. [right] PC2=-15.426 pos=324 'Ġimports' (11127_mmlu_philosophy)
 6. [wrong] PC2=-15.226 pos=349 'Ġfor' (11127_mmlu_philosophy)
 7. [wrong] PC2=-14.623 pos=362 'Ġimports' (11127_mmlu_philosophy)
 8. [wrong] PC2=-14.544 pos=406 'Ġ"' (11127_mmlu_philosophy)
 9. [right] PC2=-14.256 pos=333 'Ġor' (11127_mmlu_philosophy)
10. [wrong] PC2=-14.202 pos=303 'Ġfor' (11127_mmlu_philosophy)
11. [wrong] PC2=-13.986 pos=411 'Ġsupply' (11127_mmlu_philosophy)
12. [right] PC2=-13.911 pos=428 'Ġbe' (11127_mmlu_philosophy)
13. [wrong] PC2=-13.911 pos=306 ')' (11127_mmlu_philosophy)
14. [wrong] PC2=-13.832 pos=300 'Ġa' (11127_mmlu_philosophy)
15. [wrong] PC2=-13.743 pos=315 'Ġor' (11127_mmlu_philosophy)
16. [right] PC2=-13.708 pos=335 'China' (11127_mmlu_philosophy)
17. [wrong] PC2=-13.478 pos=398 'Ġthat' (11127_mmlu_philosophy)
18. [wrong] PC2=-13.477 pos=428 'China' (11127_mmlu_philosophy)
19. [right] PC2=-13.342 pos=375 'Ġbe' (11127_mmlu_philosophy)
20. [wrong] PC2=-13.338 pos=166 'Ġa' (12192_mmlu_engineering)

================================================================================
Top 20 tokens with HIGHEST PC2 scores (most right-like):
================================================================================
 1. [wrong] PC2= 20.370 pos= 23 '202' (11127_mmlu_philosophy)
 2. [right] PC2= 20.370 pos= 23 '202' (11127_mmlu_philosophy)
 3. [right] PC2= 20.369 pos= 23 '202' (12192_mmlu_engineering)
 4. [wrong] PC2= 20.361 pos= 23 '202' (12192_mmlu_engineering)
 5. [wrong] PC2= 19.724 pos= 51 'ĊĊ' (12192_mmlu_engineering)
 6. [right] PC2= 19.719 pos= 51 'ĊĊ' (12192_mmlu_engineering)
 7. [wrong] PC2= 19.715 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
 8. [right] PC2= 19.707 pos= 51 'ĊĊ' (11127_mmlu_philosophy)
 9. [right] PC2= 19.301 pos= 19 'Ġ' (11127_mmlu_philosophy)
10. [wrong] PC2= 19.300 pos= 19 'Ġ' (12192_mmlu_engineering)
11. [right] PC2= 19.299 pos= 19 'Ġ' (12192_mmlu_engineering)
12. [wrong] PC2= 19.297 pos= 19 'Ġ' (11127_mmlu_philosophy)
13. [wrong] PC2= 19.278 pos= 12 'Ġ' (11127_mmlu_philosophy)
14. [right] PC2= 19.274 pos= 12 'Ġ' (12192_mmlu_engineering)
15. [right] PC2= 19.273 pos= 12 'Ġ' (11127_mmlu_philosophy)
16. [wrong] PC2= 19.271 pos= 12 'Ġ' (12192_mmlu_engineering)
17. [wrong] PC2= 19.149 pos= 49 'user' (12192_mmlu_engineering)
18. [right] PC2= 19.149 pos= 49 'user' (12192_mmlu_engineering)
19. [wrong] PC2= 19.146 pos= 49 'user' (11127_mmlu_philosophy)
20. [right] PC2= 19.144 pos= 49 'user' (11127_mmlu_philosophy)

================================================================================
Analysis complete!
================================================================================
  Analyzing critical tokens for layer 30...
2025-12-11 14:44:42,246 | INFO | Loading probe data from /nobackup/bdeka/huggingface_cache/artifacts/probe_data/layer30_probe_data.npz
2025-12-11 14:44:42,261 | INFO | Loaded 1336 tokens from layer 30
2025-12-11 14:44:42,262 | INFO | Validity flag found: 1336 valid, 0 invalid
2025-12-11 14:44:42,262 | INFO | DP alignment filter applied: 1336 of 1336 tokens retained
2025-12-11 14:44:42,267 | INFO | Using 1336 tokens after filtering.
2025-12-11 14:44:42,267 | INFO | Analyzing token contributions to PC2 separation...
2025-12-11 14:44:43,721 | INFO | PCA explained variance: PC1=0.559, PC2=0.038
2025-12-11 14:44:43,736 | INFO | Saved full results to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer30_critical_tokens.json
2025-12-11 14:44:44,118 | INFO | Saved PC2 distribution plot to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer30_pc2_distribution.png

================================================================================
Top 20 tokens with LOWEST PC2 scores (most wrong-like):
================================================================================
 1. [wrong] PC2=-21.808 pos=227 'E' (11127_mmlu_philosophy)
 2. [right] PC2=-21.806 pos=227 'E' (11127_mmlu_philosophy)
 3. [wrong] PC2=-21.784 pos=182 'F' (11127_mmlu_philosophy)
 4. [right] PC2=-21.774 pos=182 'F' (11127_mmlu_philosophy)
 5. [wrong] PC2=-21.666 pos=212 'E' (11127_mmlu_philosophy)
 6. [right] PC2=-21.660 pos=212 'E' (11127_mmlu_philosophy)
 7. [right] PC2=-21.405 pos=243 'E' (11127_mmlu_philosophy)
 8. [wrong] PC2=-21.400 pos=243 'E' (11127_mmlu_philosophy)
 9. [wrong] PC2=-21.148 pos=197 'E' (11127_mmlu_philosophy)
10. [right] PC2=-21.146 pos=197 'E' (11127_mmlu_philosophy)
11. [wrong] PC2=-20.797 pos=199 'ĥ' (11127_mmlu_philosophy)
12. [right] PC2=-20.788 pos=199 'ĥ' (11127_mmlu_philosophy)
13. [wrong] PC2=-20.526 pos=166 'E' (11127_mmlu_philosophy)
14. [right] PC2=-20.522 pos=166 'E' (11127_mmlu_philosophy)
15. [wrong] PC2=-20.491 pos=184 'ĥ' (11127_mmlu_philosophy)
16. [right] PC2=-20.481 pos=184 'ĥ' (11127_mmlu_philosophy)
17. [right] PC2=-20.468 pos=214 'ĥ' (11127_mmlu_philosophy)
18. [wrong] PC2=-20.465 pos=214 'ĥ' (11127_mmlu_philosophy)
19. [wrong] PC2=-20.126 pos=204 'C' (11127_mmlu_philosophy)
20. [right] PC2=-20.108 pos=204 'C' (11127_mmlu_philosophy)

================================================================================
Top 20 tokens with HIGHEST PC2 scores (most right-like):
================================================================================
 1. [right] PC2= 21.000 pos=147 'Ġthe' (12192_mmlu_engineering)
 2. [wrong] PC2= 20.939 pos=157 'Ġthe' (12192_mmlu_engineering)
 3. [right] PC2= 20.857 pos=144 'Ġthe' (12192_mmlu_engineering)
 4. [right] PC2= 19.996 pos= 82 '.' (12192_mmlu_engineering)
 5. [wrong] PC2= 19.995 pos= 82 '.' (12192_mmlu_engineering)
 6. [right] PC2= 19.510 pos=158 'Ġthe' (12192_mmlu_engineering)
 7. [right] PC2= 19.046 pos=111 'Ġa' (12192_mmlu_engineering)
 8. [wrong] PC2= 19.038 pos=135 'Ġa' (12192_mmlu_engineering)
 9. [right] PC2= 18.770 pos=155 'Ġthe' (12192_mmlu_engineering)
10. [wrong] PC2= 18.546 pos=139 'Ġa' (12192_mmlu_engineering)
11. [right] PC2= 18.337 pos=113 'Ġhigh' (12192_mmlu_engineering)
12. [wrong] PC2= 17.938 pos=115 'Ġdynam' (12192_mmlu_engineering)
13. [wrong] PC2= 17.910 pos=147 'Ġthe' (12192_mmlu_engineering)
14. [wrong] PC2= 17.685 pos=174 'Ġuses' (12192_mmlu_engineering)
15. [right] PC2= 17.393 pos=204 'Ġwatt' (12192_mmlu_engineering)
16. [right] PC2= 17.209 pos=102 'Ġa' (12192_mmlu_engineering)
17. [wrong] PC2= 17.150 pos=134 'Ġof' (12192_mmlu_engineering)
18. [right] PC2= 16.767 pos=117 'The' (12192_mmlu_engineering)
19. [wrong] PC2= 16.732 pos=171 'Ġis' (12192_mmlu_engineering)
20. [right] PC2= 16.714 pos=103 'Ġdynam' (12192_mmlu_engineering)

================================================================================
Analysis complete!
================================================================================
  Analyzing critical tokens for layer 31...
2025-12-11 14:44:45,856 | INFO | Loading probe data from /nobackup/bdeka/huggingface_cache/artifacts/probe_data/layer31_probe_data.npz
2025-12-11 14:44:45,874 | INFO | Loaded 1336 tokens from layer 31
2025-12-11 14:44:45,874 | INFO | Validity flag found: 1336 valid, 0 invalid
2025-12-11 14:44:45,875 | INFO | DP alignment filter applied: 1336 of 1336 tokens retained
2025-12-11 14:44:45,879 | INFO | Using 1336 tokens after filtering.
2025-12-11 14:44:45,880 | INFO | Analyzing token contributions to PC2 separation...
2025-12-11 14:44:47,385 | INFO | PCA explained variance: PC1=0.098, PC2=0.064
2025-12-11 14:44:47,408 | INFO | Saved full results to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer31_critical_tokens.json
2025-12-11 14:44:47,850 | INFO | Saved PC2 distribution plot to /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token/layer31_pc2_distribution.png

================================================================================
Top 20 tokens with LOWEST PC2 scores (most wrong-like):
================================================================================
 1. [right] PC2=-78.514 pos=  0 '<|begin_of_text|>' (12192_mmlu_engineering)
 2. [right] PC2=-78.514 pos=  1 '<|begin_of_text|>' (12192_mmlu_engineering)
 3. [wrong] PC2=-78.509 pos=  0 '<|begin_of_text|>' (11127_mmlu_philosophy)
 4. [wrong] PC2=-78.509 pos=  1 '<|begin_of_text|>' (11127_mmlu_philosophy)
 5. [wrong] PC2=-78.508 pos=  0 '<|begin_of_text|>' (12192_mmlu_engineering)
 6. [wrong] PC2=-78.508 pos=  1 '<|begin_of_text|>' (12192_mmlu_engineering)
 7. [right] PC2=-78.506 pos=  0 '<|begin_of_text|>' (11127_mmlu_philosophy)
 8. [right] PC2=-78.506 pos=  1 '<|begin_of_text|>' (11127_mmlu_philosophy)
 9. [wrong] PC2=-74.588 pos=  5 'ĊĊ' (11127_mmlu_philosophy)
10. [wrong] PC2=-74.582 pos=  5 'ĊĊ' (12192_mmlu_engineering)
11. [right] PC2=-74.568 pos=  5 'ĊĊ' (12192_mmlu_engineering)
12. [right] PC2=-74.563 pos=  5 'ĊĊ' (11127_mmlu_philosophy)
13. [wrong] PC2=-72.687 pos=255 ')ĊĊ' (11127_mmlu_philosophy)
14. [right] PC2=-72.677 pos=255 ')ĊĊ' (11127_mmlu_philosophy)
15. [right] PC2=-71.680 pos= 25 'ĊĊ' (12192_mmlu_engineering)
16. [wrong] PC2=-71.676 pos= 25 'ĊĊ' (11127_mmlu_philosophy)
17. [wrong] PC2=-71.668 pos= 25 'ĊĊ' (12192_mmlu_engineering)
18. [right] PC2=-71.646 pos= 25 'ĊĊ' (11127_mmlu_philosophy)
19. [right] PC2=-69.062 pos=244 'ĠâĬ' (11127_mmlu_philosophy)
20. [wrong] PC2=-69.055 pos=244 'ĠâĬ' (11127_mmlu_philosophy)

================================================================================
Top 20 tokens with HIGHEST PC2 scores (most right-like):
================================================================================
 1. [right] PC2= 62.959 pos=172 'Ġthrough' (12192_mmlu_engineering)
 2. [right] PC2= 61.663 pos=196 'Ġof' (12192_mmlu_engineering)
 3. [right] PC2= 61.101 pos=200 'Ġof' (12192_mmlu_engineering)
 4. [right] PC2= 59.545 pos=146 'Ġthrough' (12192_mmlu_engineering)
 5. [right] PC2= 58.943 pos=101 'Ġof' (12192_mmlu_engineering)
 6. [right] PC2= 57.574 pos=199 'Ġcoil' (12192_mmlu_engineering)
 7. [right] PC2= 57.361 pos=193 'Ġin' (12192_mmlu_engineering)
 8. [right] PC2= 56.432 pos=205 'meter' (12192_mmlu_engineering)
 9. [right] PC2= 56.043 pos=153 'Ġcompared' (12192_mmlu_engineering)
10. [right] PC2= 55.407 pos=327 'Ġthen' (11127_mmlu_philosophy)
11. [right] PC2= 54.979 pos=368 'Ġthen' (11127_mmlu_philosophy)
12. [right] PC2= 54.646 pos=173 'Ġthe' (12192_mmlu_engineering)
13. [right] PC2= 54.507 pos=324 'Ġimports' (11127_mmlu_philosophy)
14. [right] PC2= 53.812 pos=198 'Ġmoving' (12192_mmlu_engineering)
15. [right] PC2= 53.384 pos=195 'Ġcircuit' (12192_mmlu_engineering)
16. [right] PC2= 53.292 pos=192 'Ġresistance' (12192_mmlu_engineering)
17. [right] PC2= 53.143 pos=333 'Ġor' (11127_mmlu_philosophy)
18. [right] PC2= 52.957 pos=336 'Ġpromotes' (11127_mmlu_philosophy)
19. [wrong] PC2= 52.884 pos=349 'Ġfor' (11127_mmlu_philosophy)
20. [right] PC2= 52.532 pos=282 'Ġfor' (11127_mmlu_philosophy)

================================================================================
Analysis complete!
================================================================================
=== Step 6: Computing steering vectors from last_token representations ===
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/transformers/utils/hub.py:127: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
2025-12-11 14:44:50,190 | INFO | Loaded 100 triples
2025-12-11 14:44:50,190 | INFO | Target layers for steering vector computation: [26, 27, 28, 29, 30, 31]
2025-12-11 14:44:50,365 | INFO | Loading model meta-llama/Llama-3.1-8B-Instruct on cuda with dtype torch.float16
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 13695.69it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:06,  2.11s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.11s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.18s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.54s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.76s/it]
Computing steering vectors:   0%|          | 0/100 [00:00<?, ?it/s]Computing steering vectors:   1%|          | 1/100 [00:01<02:38,  1.60s/it]Computing steering vectors:   2%|▏         | 2/100 [00:02<01:46,  1.09s/it]Computing steering vectors:   3%|▎         | 3/100 [00:02<01:26,  1.12it/s]Computing steering vectors:   4%|▍         | 4/100 [00:03<01:08,  1.40it/s]Computing steering vectors:   5%|▌         | 5/100 [00:04<01:12,  1.32it/s]Computing steering vectors:   6%|▌         | 6/100 [00:05<01:27,  1.07it/s]Computing steering vectors:   7%|▋         | 7/100 [00:06<01:17,  1.20it/s]Computing steering vectors:   8%|▊         | 8/100 [00:06<01:06,  1.37it/s]Computing steering vectors:   9%|▉         | 9/100 [00:07<00:56,  1.62it/s]Computing steering vectors:  10%|█         | 10/100 [00:07<00:56,  1.60it/s]Computing steering vectors:  11%|█         | 11/100 [00:08<00:54,  1.63it/s]Computing steering vectors:  12%|█▏        | 12/100 [00:08<00:48,  1.80it/s]Computing steering vectors:  13%|█▎        | 13/100 [00:09<00:56,  1.55it/s]Computing steering vectors:  14%|█▍        | 14/100 [00:10<01:10,  1.22it/s]Computing steering vectors:  15%|█▌        | 15/100 [00:12<01:29,  1.05s/it]Computing steering vectors:  16%|█▌        | 16/100 [00:13<01:37,  1.17s/it]Computing steering vectors:  17%|█▋        | 17/100 [00:14<01:28,  1.06s/it]Computing steering vectors:  18%|█▊        | 18/100 [00:15<01:16,  1.07it/s]Computing steering vectors:  19%|█▉        | 19/100 [00:15<01:03,  1.27it/s]Computing steering vectors:  20%|██        | 20/100 [00:16<01:11,  1.11it/s]Computing steering vectors:  21%|██        | 21/100 [00:17<01:04,  1.22it/s]Computing steering vectors:  22%|██▏       | 22/100 [00:18<01:00,  1.29it/s]Computing steering vectors:  23%|██▎       | 23/100 [00:18<00:56,  1.36it/s]Computing steering vectors:  24%|██▍       | 24/100 [00:19<00:50,  1.51it/s]Computing steering vectors:  25%|██▌       | 25/100 [00:20<00:54,  1.38it/s]Computing steering vectors:  26%|██▌       | 26/100 [00:20<00:52,  1.41it/s]Computing steering vectors:  27%|██▋       | 27/100 [00:21<00:44,  1.63it/s]Computing steering vectors:  28%|██▊       | 28/100 [00:22<00:47,  1.51it/s]Computing steering vectors:  29%|██▉       | 29/100 [00:22<00:46,  1.54it/s]Computing steering vectors:  30%|███       | 30/100 [00:23<00:45,  1.54it/s]Computing steering vectors:  31%|███       | 31/100 [00:24<00:51,  1.34it/s]Computing steering vectors:  32%|███▏      | 32/100 [00:25<00:57,  1.19it/s]Computing steering vectors:  33%|███▎      | 33/100 [00:26<00:55,  1.20it/s]Computing steering vectors:  34%|███▍      | 34/100 [00:26<00:48,  1.36it/s]Computing steering vectors:  35%|███▌      | 35/100 [00:27<00:44,  1.45it/s]Computing steering vectors:  36%|███▌      | 36/100 [00:27<00:44,  1.44it/s]Computing steering vectors:  37%|███▋      | 37/100 [00:29<00:51,  1.21it/s]Computing steering vectors:  38%|███▊      | 38/100 [00:29<00:50,  1.23it/s]Computing steering vectors:  39%|███▉      | 39/100 [00:30<00:46,  1.31it/s]Computing steering vectors:  40%|████      | 40/100 [00:31<00:48,  1.23it/s]Computing steering vectors:  41%|████      | 41/100 [00:31<00:42,  1.39it/s]Computing steering vectors:  42%|████▏     | 42/100 [00:32<00:40,  1.42it/s]Computing steering vectors:  43%|████▎     | 43/100 [00:33<00:48,  1.17it/s]Computing steering vectors:  44%|████▍     | 44/100 [00:34<00:42,  1.31it/s]Computing steering vectors:  45%|████▌     | 45/100 [00:35<00:44,  1.24it/s]Computing steering vectors:  46%|████▌     | 46/100 [00:35<00:40,  1.34it/s]Computing steering vectors:  47%|████▋     | 47/100 [00:36<00:36,  1.46it/s]Computing steering vectors:  48%|████▊     | 48/100 [00:37<00:39,  1.30it/s]Computing steering vectors:  49%|████▉     | 49/100 [00:37<00:37,  1.38it/s]Computing steering vectors:  50%|█████     | 50/100 [00:39<00:42,  1.17it/s]Computing steering vectors:  51%|█████     | 51/100 [00:40<00:44,  1.09it/s]Computing steering vectors:  52%|█████▏    | 52/100 [00:41<00:49,  1.03s/it]Computing steering vectors:  53%|█████▎    | 53/100 [00:43<00:56,  1.21s/it]Computing steering vectors:  54%|█████▍    | 54/100 [00:43<00:49,  1.07s/it]Computing steering vectors:  55%|█████▌    | 55/100 [00:44<00:42,  1.06it/s]Computing steering vectors:  56%|█████▌    | 56/100 [00:45<00:38,  1.14it/s]Computing steering vectors:  57%|█████▋    | 57/100 [00:47<00:49,  1.15s/it]Computing steering vectors:  58%|█████▊    | 58/100 [00:48<00:50,  1.21s/it]Computing steering vectors:  59%|█████▉    | 59/100 [00:48<00:39,  1.04it/s]Computing steering vectors:  60%|██████    | 60/100 [00:49<00:32,  1.22it/s]Computing steering vectors:  61%|██████    | 61/100 [00:50<00:32,  1.21it/s]Computing steering vectors:  62%|██████▏   | 62/100 [00:50<00:30,  1.25it/s]Computing steering vectors:  63%|██████▎   | 63/100 [00:51<00:33,  1.11it/s]Computing steering vectors:  64%|██████▍   | 64/100 [00:52<00:30,  1.18it/s]Computing steering vectors:  65%|██████▌   | 65/100 [00:53<00:30,  1.15it/s]Computing steering vectors:  66%|██████▌   | 66/100 [00:54<00:26,  1.30it/s]Computing steering vectors:  67%|██████▋   | 67/100 [00:55<00:28,  1.16it/s]Computing steering vectors:  68%|██████▊   | 68/100 [00:56<00:28,  1.14it/s]Computing steering vectors:  69%|██████▉   | 69/100 [00:57<00:30,  1.01it/s]Computing steering vectors:  70%|███████   | 70/100 [00:57<00:26,  1.14it/s]Computing steering vectors:  71%|███████   | 71/100 [00:59<00:30,  1.05s/it]Computing steering vectors:  72%|███████▏  | 72/100 [01:00<00:33,  1.19s/it]Computing steering vectors:  73%|███████▎  | 73/100 [01:01<00:27,  1.01s/it]Computing steering vectors:  74%|███████▍  | 74/100 [01:02<00:26,  1.01s/it]Computing steering vectors:  75%|███████▌  | 75/100 [01:03<00:23,  1.08it/s]Computing steering vectors:  76%|███████▌  | 76/100 [01:03<00:20,  1.19it/s]Computing steering vectors:  77%|███████▋  | 77/100 [01:04<00:17,  1.35it/s]Computing steering vectors:  78%|███████▊  | 78/100 [01:05<00:17,  1.23it/s]Computing steering vectors:  79%|███████▉  | 79/100 [01:05<00:15,  1.37it/s]Computing steering vectors:  80%|████████  | 80/100 [01:06<00:16,  1.21it/s]Computing steering vectors:  81%|████████  | 81/100 [01:08<00:17,  1.10it/s]Computing steering vectors:  82%|████████▏ | 82/100 [01:08<00:14,  1.23it/s]Computing steering vectors:  83%|████████▎ | 83/100 [01:09<00:12,  1.35it/s]Computing steering vectors:  84%|████████▍ | 84/100 [01:09<00:11,  1.41it/s]Computing steering vectors:  85%|████████▌ | 85/100 [01:10<00:09,  1.53it/s]Computing steering vectors:  86%|████████▌ | 86/100 [01:11<00:09,  1.41it/s]Computing steering vectors:  87%|████████▋ | 87/100 [01:11<00:09,  1.39it/s]Computing steering vectors:  88%|████████▊ | 88/100 [01:13<00:11,  1.04it/s]Computing steering vectors:  89%|████████▉ | 89/100 [01:14<00:09,  1.11it/s]Computing steering vectors:  90%|█████████ | 90/100 [01:15<00:09,  1.11it/s]Computing steering vectors:  91%|█████████ | 91/100 [01:15<00:07,  1.22it/s]Computing steering vectors:  92%|█████████▏| 92/100 [01:16<00:05,  1.37it/s]Computing steering vectors:  93%|█████████▎| 93/100 [01:16<00:04,  1.46it/s]Computing steering vectors:  94%|█████████▍| 94/100 [01:17<00:04,  1.35it/s]Computing steering vectors:  95%|█████████▌| 95/100 [01:18<00:03,  1.35it/s]Computing steering vectors:  96%|█████████▌| 96/100 [01:19<00:03,  1.29it/s]Computing steering vectors:  97%|█████████▋| 97/100 [01:20<00:02,  1.27it/s]Computing steering vectors:  98%|█████████▊| 98/100 [01:20<00:01,  1.33it/s]Computing steering vectors:  99%|█████████▉| 99/100 [01:21<00:00,  1.35it/s]Computing steering vectors: 100%|██████████| 100/100 [01:22<00:00,  1.48it/s]Computing steering vectors: 100%|██████████| 100/100 [01:22<00:00,  1.22it/s]
2025-12-11 14:46:22,213 | INFO | Processed 100 triples (skipped 0, gradient fallbacks 0)
2025-12-11 14:46:22,215 | INFO | Layer 26: Computed steering vector from 100 samples (shape: (4096,), norm: 15.2798)
2025-12-11 14:46:22,216 | INFO | Saved steering vector for layer 26 to /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/layer26_steering_vector.npy
2025-12-11 14:46:22,217 | INFO | Layer 27: Computed steering vector from 100 samples (shape: (4096,), norm: 16.2321)
2025-12-11 14:46:22,218 | INFO | Saved steering vector for layer 27 to /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/layer27_steering_vector.npy
2025-12-11 14:46:22,219 | INFO | Layer 28: Computed steering vector from 100 samples (shape: (4096,), norm: 17.5593)
2025-12-11 14:46:22,220 | INFO | Saved steering vector for layer 28 to /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/layer28_steering_vector.npy
2025-12-11 14:46:22,221 | INFO | Layer 29: Computed steering vector from 100 samples (shape: (4096,), norm: 19.0103)
2025-12-11 14:46:22,221 | INFO | Saved steering vector for layer 29 to /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/layer29_steering_vector.npy
2025-12-11 14:46:22,222 | INFO | Layer 30: Computed steering vector from 100 samples (shape: (4096,), norm: 20.6091)
2025-12-11 14:46:22,222 | INFO | Saved steering vector for layer 30 to /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/layer30_steering_vector.npy
2025-12-11 14:46:22,223 | INFO | Layer 31: Computed steering vector from 100 samples (shape: (4096,), norm: 90.4260)
2025-12-11 14:46:22,223 | INFO | Saved steering vector for layer 31 to /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/layer31_steering_vector.npy
2025-12-11 14:46:22,224 | INFO | Saved metadata to /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/steering_vectors_metadata.json
2025-12-11 14:46:22,224 | INFO | Steering vector computation complete!
=== Step 7: Evaluating steering vectors ===
Evaluating steering for layer 29...
Evaluating in-sample steering performance...
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/transformers/utils/hub.py:127: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
2025-12-11 14:46:31,860 | INFO | Loaded 100 triples for evaluation
2025-12-11 14:46:31,862 | INFO | Loaded steering vector for layer 29 (shape: (4096,), norm: 19.0103)
2025-12-11 14:46:32,071 | INFO | Loading model meta-llama/Llama-3.1-8B-Instruct on cuda with dtype torch.float16
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 14051.27it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:07,  2.48s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.30s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.18s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.52s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.80s/it]
Evaluating steering:   0%|          | 0/100 [00:00<?, ?it/s]/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/transformers/generation/configuration_utils.py:567: UserWarning: `do_sample` is set to `False`. However, `temperature` is set to `0.0` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `temperature`.
  warnings.warn(
Evaluating steering:   1%|          | 1/100 [00:24<39:46, 24.11s/it]Evaluating steering:   2%|▏         | 2/100 [01:16<1:06:35, 40.77s/it]Evaluating steering:   3%|▎         | 3/100 [02:03<1:10:10, 43.40s/it]Evaluating steering:   4%|▍         | 4/100 [02:26<56:35, 35.36s/it]  Evaluating steering:   5%|▌         | 5/100 [02:51<50:22, 31.82s/it]Evaluating steering:   6%|▌         | 6/100 [04:05<1:12:05, 46.01s/it]Evaluating steering:   7%|▋         | 7/100 [05:01<1:16:21, 49.27s/it]Evaluating steering:   8%|▊         | 8/100 [05:27<1:04:18, 41.94s/it]Evaluating steering:   9%|▉         | 9/100 [05:50<54:29, 35.93s/it]  Evaluating steering:  10%|█         | 10/100 [06:29<55:36, 37.07s/it]Evaluating steering:  11%|█         | 11/100 [06:56<50:10, 33.83s/it]Evaluating steering:  12%|█▏        | 12/100 [07:26<47:49, 32.61s/it]Evaluating steering:  13%|█▎        | 13/100 [08:47<1:08:32, 47.27s/it]Evaluating steering:  14%|█▍        | 14/100 [10:11<1:23:58, 58.59s/it]Evaluating steering:  15%|█▌        | 15/100 [11:22<1:28:14, 62.29s/it]Evaluating steering:  16%|█▌        | 16/100 [12:39<1:33:14, 66.60s/it]Evaluating steering:  17%|█▋        | 17/100 [13:21<1:22:07, 59.37s/it]Evaluating steering:  18%|█▊        | 18/100 [13:59<1:12:07, 52.78s/it]Evaluating steering:  19%|█▉        | 19/100 [14:41<1:07:00, 49.64s/it]Evaluating steering:  20%|██        | 20/100 [16:16<1:24:16, 63.20s/it]Evaluating steering:  21%|██        | 21/100 [16:51<1:12:11, 54.83s/it]Evaluating steering:  22%|██▏       | 22/100 [17:24<1:02:43, 48.25s/it]Evaluating steering:  23%|██▎       | 23/100 [18:07<59:53, 46.67s/it]  Evaluating steering:  24%|██▍       | 24/100 [18:28<49:29, 39.07s/it]Evaluating steering:  25%|██▌       | 25/100 [19:01<46:30, 37.21s/it]Evaluating steering:  26%|██▌       | 26/100 [19:29<42:29, 34.45s/it]Evaluating steering:  27%|██▋       | 27/100 [19:47<35:42, 29.35s/it]Evaluating steering:  28%|██▊       | 28/100 [20:36<42:31, 35.44s/it]Evaluating steering:  29%|██▉       | 29/100 [21:23<45:48, 38.71s/it]Evaluating steering:  30%|███       | 30/100 [22:04<46:06, 39.52s/it]Evaluating steering:  31%|███       | 31/100 [23:03<52:03, 45.27s/it]Evaluating steering:  32%|███▏      | 32/100 [24:08<58:03, 51.22s/it]Evaluating steering:  33%|███▎      | 33/100 [24:56<56:16, 50.40s/it]Evaluating steering:  34%|███▍      | 34/100 [25:35<51:40, 46.98s/it]Evaluating steering:  35%|███▌      | 35/100 [26:18<49:26, 45.63s/it]Evaluating steering:  36%|███▌      | 36/100 [27:04<48:40, 45.63s/it]Evaluating steering:  37%|███▋      | 37/100 [27:42<45:33, 43.38s/it]Evaluating steering:  38%|███▊      | 38/100 [29:14<1:00:08, 58.20s/it]Evaluating steering:  39%|███▉      | 39/100 [29:55<53:54, 53.03s/it]  Evaluating steering:  40%|████      | 40/100 [30:38<49:59, 49.99s/it]Evaluating steering:  41%|████      | 41/100 [31:09<43:25, 44.16s/it]Evaluating steering:  42%|████▏     | 42/100 [31:43<39:38, 41.01s/it]Evaluating steering:  43%|████▎     | 43/100 [32:57<48:26, 50.99s/it]Evaluating steering:  44%|████▍     | 44/100 [33:37<44:26, 47.62s/it]Evaluating steering:  45%|████▌     | 45/100 [34:32<45:51, 50.03s/it]Evaluating steering:  46%|████▌     | 46/100 [35:14<42:49, 47.59s/it]Evaluating steering:  47%|████▋     | 47/100 [35:38<35:50, 40.58s/it]Evaluating steering:  48%|████▊     | 48/100 [36:13<33:32, 38.71s/it]Evaluating steering:  49%|████▉     | 49/100 [37:01<35:23, 41.64s/it]Evaluating steering:  50%|█████     | 50/100 [38:12<42:00, 50.41s/it]Evaluating steering:  51%|█████     | 51/100 [39:07<42:17, 51.80s/it]Evaluating steering:  52%|█████▏    | 52/100 [40:37<50:32, 63.18s/it]Evaluating steering:  53%|█████▎    | 53/100 [41:51<52:02, 66.44s/it]Evaluating steering:  54%|█████▍    | 54/100 [42:25<43:30, 56.76s/it]Evaluating steering:  55%|█████▌    | 55/100 [43:03<38:20, 51.12s/it]Evaluating steering:  56%|█████▌    | 56/100 [43:53<37:10, 50.70s/it]Evaluating steering:  57%|█████▋    | 57/100 [45:02<40:15, 56.18s/it]Evaluating steering:  58%|█████▊    | 58/100 [46:37<47:37, 68.02s/it]Evaluating steering:  59%|█████▉    | 59/100 [46:57<36:32, 53.47s/it]Evaluating steering:  60%|██████    | 60/100 [47:23<30:13, 45.34s/it]Evaluating steering:  61%|██████    | 61/100 [48:08<29:22, 45.20s/it]Evaluating steering:  62%|██████▏   | 62/100 [48:38<25:37, 40.46s/it]Evaluating steering:  63%|██████▎   | 63/100 [49:38<28:35, 46.37s/it]Evaluating steering:  64%|██████▍   | 64/100 [50:05<24:18, 40.52s/it]Evaluating steering:  65%|██████▌   | 65/100 [50:44<23:22, 40.08s/it]Evaluating steering:  66%|██████▌   | 66/100 [51:19<21:52, 38.62s/it]Evaluating steering:  67%|██████▋   | 67/100 [52:25<25:43, 46.77s/it]Evaluating steering:  68%|██████▊   | 68/100 [53:09<24:30, 45.95s/it]Evaluating steering:  69%|██████▉   | 69/100 [53:45<22:16, 43.12s/it]Evaluating steering:  70%|███████   | 70/100 [54:24<20:55, 41.86s/it]Evaluating steering:  71%|███████   | 71/100 [55:40<25:08, 52.02s/it]Evaluating steering:  72%|███████▏  | 72/100 [56:59<28:06, 60.24s/it]Evaluating steering:  73%|███████▎  | 73/100 [57:26<22:34, 50.16s/it]Evaluating steering:  74%|███████▍  | 74/100 [58:16<21:41, 50.05s/it]Evaluating steering:  75%|███████▌  | 75/100 [59:25<23:14, 55.78s/it]Evaluating steering:  76%|███████▌  | 76/100 [59:58<19:33, 48.89s/it]Evaluating steering:  77%|███████▋  | 77/100 [1:00:27<16:31, 43.10s/it]Evaluating steering:  78%|███████▊  | 78/100 [1:01:54<20:38, 56.31s/it]Evaluating steering:  79%|███████▉  | 79/100 [1:02:47<19:19, 55.22s/it]Evaluating steering:  80%|████████  | 80/100 [1:03:29<17:03, 51.18s/it]Evaluating steering:  81%|████████  | 81/100 [1:04:15<15:42, 49.60s/it]Evaluating steering:  82%|████████▏ | 82/100 [1:04:32<11:58, 39.94s/it]Evaluating steering:  83%|████████▎ | 83/100 [1:05:18<11:47, 41.62s/it]Evaluating steering:  84%|████████▍ | 84/100 [1:06:30<13:34, 50.88s/it]Evaluating steering:  85%|████████▌ | 85/100 [1:06:53<10:36, 42.40s/it]Evaluating steering:  86%|████████▌ | 86/100 [1:07:19<08:47, 37.68s/it]Evaluating steering:  87%|████████▋ | 87/100 [1:08:09<08:54, 41.13s/it]Evaluating steering:  88%|████████▊ | 88/100 [1:09:49<11:45, 58.77s/it]Evaluating steering:  89%|████████▉ | 89/100 [1:10:49<10:52, 59.36s/it]Evaluating steering:  90%|█████████ | 90/100 [1:11:43<09:37, 57.79s/it]Evaluating steering:  91%|█████████ | 91/100 [1:12:19<07:40, 51.13s/it]Evaluating steering:  92%|█████████▏| 92/100 [1:12:51<06:03, 45.47s/it]Evaluating steering:  93%|█████████▎| 93/100 [1:13:53<05:51, 50.24s/it]Evaluating steering:  94%|█████████▍| 94/100 [1:14:28<04:33, 45.65s/it]Evaluating steering:  95%|█████████▌| 95/100 [1:15:41<04:30, 54.05s/it]Evaluating steering:  96%|█████████▌| 96/100 [1:16:40<03:42, 55.58s/it]Evaluating steering:  97%|█████████▋| 97/100 [1:17:29<02:40, 53.57s/it]Evaluating steering:  98%|█████████▊| 98/100 [1:18:09<01:38, 49.32s/it]Evaluating steering:  99%|█████████▉| 99/100 [1:19:04<00:51, 51.06s/it]Evaluating steering: 100%|██████████| 100/100 [1:19:30<00:00, 43.69s/it]Evaluating steering: 100%|██████████| 100/100 [1:19:30<00:00, 47.71s/it]
2025-12-11 16:06:15,593 | INFO | Saved evaluation results to /nobackup/bdeka/huggingface_cache/artifacts/steering_evaluation_in_sample/steering_evaluation_results_offset0.json
2025-12-11 16:06:15,593 | INFO | ============================================================
2025-12-11 16:06:15,593 | INFO | Steering Evaluation Results
2025-12-11 16:06:15,593 | INFO | ============================================================
2025-12-11 16:06:15,593 | INFO | Total triples evaluated: 100
2025-12-11 16:06:15,593 | INFO | 
2025-12-11 16:06:15,593 | INFO | Without steering:
2025-12-11 16:06:15,593 | INFO |   Correct: 6
2025-12-11 16:06:15,593 | INFO |   Incorrect: 94
2025-12-11 16:06:15,593 | INFO |   Accuracy: 6.00%
2025-12-11 16:06:15,593 | INFO | 
2025-12-11 16:06:15,593 | INFO | With steering (coefficient=1.00):
2025-12-11 16:06:15,593 | INFO |   Correct: 15
2025-12-11 16:06:15,594 | INFO |   Incorrect: 85
2025-12-11 16:06:15,594 | INFO |   Accuracy: 15.00%
2025-12-11 16:06:15,594 | INFO | 
2025-12-11 16:06:15,594 | INFO | Improvements (wrong -> correct): 15
2025-12-11 16:06:15,594 | INFO | Degradations (correct -> wrong): 6
2025-12-11 16:06:15,594 | INFO | 
2025-12-11 16:06:15,594 | INFO | Accuracy change: +9.00%
2025-12-11 16:06:15,594 | INFO | ============================================================
With steering: C
results['with_steering']['correct']: 1
With steering: E
results['with_steering']['correct']: 1
With steering: E
results['with_steering']['correct']: 1
With steering: B
results['with_steering']['correct']: 2
With steering: A
results['with_steering']['correct']: 2
With steering: In this case, a =
results['with_steering']['correct']: 2
With steering: D
results['with_steering']['correct']: 2
With steering: D
results['with_steering']['correct']: 2
With steering: D
results['with_steering']['correct']: 2
With steering: G
results['with_steering']['correct']: 2
With steering: D
results['with_steering']['correct']: 2
With steering: B
results['with_steering']['correct']: 3
With steering: H
results['with_steering']['correct']: 3
With steering: B
results['with_steering']['correct']: 3
With steering: A
results['with_steering']['correct']: 4
With steering: C
results['with_steering']['correct']: 4
With steering: I
results['with_steering']['correct']: 4
With steering: B
results['with_steering']['correct']: 4
With steering: B
results['with_steering']['correct']: 4
With steering: (b) Without a catalyst, the reaction does not occur, so the total pressure remains the same as the initial pressure of CO and H_3. The initial pressure of CO is 0.1 * 0.082/2 = 0.0041 atm and the initial pressure of H_2 is 0.3 * 0.082 = 0.0246 atm. The total initial pressure is 0.0041 + 0.0246 = 0.0287 atm. The total pressure after adding hydrogen is 7 atm. The amount of hydrogen added is 7 - 0.0287 = 6.9713 atm. The
results['with_steering']['correct']: 4
With steering: B
results['with_steering']['correct']: 4
With steering: D
results['with_steering']['correct']: 4
With steering: B
results['with_steering']['correct']: 4
With steering: B
results['with_steering']['correct']: 4
With steering: E
results['with_steering']['correct']: 4
With steering: C
results['with_steering']['correct']: 4
With steering: H
results['with_steering']['correct']: 4
With steering: I
results['with_steering']['correct']: 4
With steering: I
results['with_steering']['correct']: 4
With steering: B
results['with_steering']['correct']: 4
With steering: i
results['with_steering']['correct']: 4
With steering: s
results['with_steering']['correct']: 4
With steering: A
results['with_steering']['correct']: 4
With steering: I
results['with_steering']['correct']: 5
With steering: D
results['with_steering']['correct']: 5
With steering: D
results['with_steering']['correct']: 5
With steering: J
results['with_steering']['correct']: 5
With steering: c
results['with_steering']['correct']: 5
With steering: C
results['with_steering']['correct']: 5
With steering: C
results['with_steering']['correct']: 6
With steering: B
results['with_steering']['correct']: 6
With steering: D
results['with_steering']['correct']: 6
With steering: i
results['with_steering']['correct']: 6
With steering: B
results['with_steering']['correct']: 6
With steering: I
results['with_steering']['correct']: 6
With steering: D
results['with_steering']['correct']: 6
With steering: D
results['with_steering']['correct']: 7
With steering: F
results['with_steering']['correct']: 7
With steering: E
results['with_steering']['correct']: 7
With steering: - Total sales in terms of the cost is not possible to find because we do not have enough information. However, we can find the stock turnover in terms in the cost by using the total sales in the cost and the total cost. The total sales in the cost
results['with_steering']['correct']: 7
With steering: i
results['with_steering']['correct']: 7
With steering: Given the available
results['with_steering']['correct']: 7
With steering: However
results['with_steering']['correct']: 7
With steering: F
results['with_steering']['correct']: 7
With steering: C
results['with_steering']['correct']: 8
With steering: F
results['with_steering']['correct']: 9
With steering: i
results['with_steering']['correct']: 9
With steering: VSWP = (5 + 2) / (5 -2) = 7/3 =
results['with_steering']['correct']: 9
With steering: C
results['with_steering']['correct']: 9
With steering: J
results['with_steering']['correct']: 9
With steering: i
results['with_steering']['correct']: 9
With steering: E
results['with_steering']['correct']: 10
With steering: A
results['with_steering']['correct']: 10
With steering: E
results['with_steering']['correct']: 10
With steering: I
results['with_steering']['correct']: 10
With steering: E
results['with_steering']['correct']: 10
With steering: A
results['with_steering']['correct']: 11
With steering: G
results['with_steering']['correct']: 11
With steering: F
results['with_steering']['correct']: 11
With steering: H
results['with_steering']['correct']: 11
With steering: J
results['with_steering']['correct']: 11
With steering: C
results['with_steering']['correct']: 11
With steering: E
results['with_steering']['correct']: 12
With steering: B
results['with_steering']['correct']: 12
With steering: J
results['with_steering']['correct']: 12
With steering: B
results['with_steering']['correct']: 13
With steering: G
results['with_steering']['correct']: 13
With steering: G
results['with_steering']['correct']: 13
With steering: D
results['with_steering']['correct']: 13
With steering: J
results['with_steering']['correct']: 14
With steering: i
results['with_steering']['correct']: 14
With steering: E
results['with_steering']['correct']: 14
With steering: F
results['with_steering']['correct']: 14
With steering: A
results['with_steering']['correct']: 15
With steering: C
results['with_steering']['correct']: 15
With steering: B
results['with_steering']['correct']: 15
With steering: I
results['with_steering']['correct']: 15
With steering: H(Y) ≈ - [plog2p + (1-p
results['with_steering']['correct']: 15
With steering: C
results['with_steering']['correct']: 15
With steering: B
results['with_steering']['correct']: 15
With steering: C
results['with_steering']['correct']: 15
With steering: F
results['with_steering']['correct']: 15
With steering: The ratio of object size to image size
results['with_steering']['correct']: 15
With steering: H
results['with_steering']['correct']: 15
With steering: The area under the curve
results['with_steering']['correct']: 15
With steering: i
results['with_steering']['correct']: 15
With steering: I
results['with_steering']['correct']: 15
With steering: F
results['with_steering']['correct']: 15
With steering: J
results['with_steering']['correct']: 15
With steering: C
results['with_steering']['correct']: 15
Evaluating out-of-sample steering performance...
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/transformers/utils/hub.py:127: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
2025-12-11 16:06:25,175 | INFO | Loaded 100 triples for evaluation
2025-12-11 16:06:25,176 | INFO | Loaded steering vector for layer 29 (shape: (4096,), norm: 19.0103)
2025-12-11 16:06:25,383 | INFO | Loading model meta-llama/Llama-3.1-8B-Instruct on cuda with dtype torch.float16
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 10837.99it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:06,  2.11s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.12s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.11s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:06<00:00,  1.48s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:06<00:00,  1.71s/it]
Evaluating steering:   0%|          | 0/100 [00:00<?, ?it/s]/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/transformers/generation/configuration_utils.py:567: UserWarning: `do_sample` is set to `False`. However, `temperature` is set to `0.0` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `temperature`.
  warnings.warn(
Evaluating steering:   1%|          | 1/100 [00:40<1:07:36, 40.98s/it]Evaluating steering:   2%|▏         | 2/100 [01:22<1:07:22, 41.25s/it]Evaluating steering:   3%|▎         | 3/100 [02:03<1:06:35, 41.19s/it]Evaluating steering:   4%|▍         | 4/100 [02:38<1:02:11, 38.87s/it]Evaluating steering:   5%|▌         | 5/100 [03:12<58:41, 37.07s/it]  Evaluating steering:   6%|▌         | 6/100 [03:46<56:06, 35.81s/it]Evaluating steering:   7%|▋         | 7/100 [04:22<55:36, 35.88s/it]Evaluating steering:   8%|▊         | 8/100 [04:37<44:50, 29.25s/it]Evaluating steering:   9%|▉         | 9/100 [06:10<1:14:42, 49.25s/it]Evaluating steering:  10%|█         | 10/100 [06:49<1:09:09, 46.10s/it]Evaluating steering:  11%|█         | 11/100 [07:37<1:09:05, 46.58s/it]Evaluating steering:  12%|█▏        | 12/100 [08:04<59:39, 40.68s/it]  Evaluating steering:  13%|█▎        | 13/100 [09:08<1:09:29, 47.92s/it]Evaluating steering:  14%|█▍        | 14/100 [09:39<1:01:03, 42.59s/it]Evaluating steering:  15%|█▌        | 15/100 [09:58<50:29, 35.64s/it]  Evaluating steering:  16%|█▌        | 16/100 [10:47<55:27, 39.62s/it]Evaluating steering:  17%|█▋        | 17/100 [12:10<1:12:54, 52.71s/it]Evaluating steering:  18%|█▊        | 18/100 [12:37<1:01:20, 44.88s/it]Evaluating steering:  19%|█▉        | 19/100 [12:52<48:29, 35.91s/it]  Evaluating steering:  20%|██        | 20/100 [13:46<55:02, 41.28s/it]Evaluating steering:  21%|██        | 21/100 [14:34<57:20, 43.55s/it]Evaluating steering:  22%|██▏       | 22/100 [15:26<59:49, 46.02s/it]Evaluating steering:  23%|██▎       | 23/100 [16:01<54:45, 42.67s/it]Evaluating steering:  24%|██▍       | 24/100 [16:50<56:29, 44.60s/it]Evaluating steering:  25%|██▌       | 25/100 [17:26<52:17, 41.83s/it]Evaluating steering:  26%|██▌       | 26/100 [18:42<1:04:16, 52.12s/it]Evaluating steering:  27%|██▋       | 27/100 [19:23<59:34, 48.97s/it]  Evaluating steering:  28%|██▊       | 28/100 [20:30<1:04:57, 54.13s/it]Evaluating steering:  29%|██▉       | 29/100 [21:12<59:54, 50.63s/it]  Evaluating steering:  30%|███       | 30/100 [21:50<54:48, 46.97s/it]Evaluating steering:  31%|███       | 31/100 [22:45<56:35, 49.21s/it]Evaluating steering:  32%|███▏      | 32/100 [23:13<48:44, 43.01s/it]Evaluating steering:  33%|███▎      | 33/100 [23:44<43:57, 39.37s/it]Evaluating steering:  34%|███▍      | 34/100 [24:31<45:35, 41.45s/it]Evaluating steering:  35%|███▌      | 35/100 [25:17<46:25, 42.85s/it]Evaluating steering:  36%|███▌      | 36/100 [26:27<54:27, 51.05s/it]Evaluating steering:  37%|███▋      | 37/100 [27:08<50:27, 48.06s/it]Evaluating steering:  38%|███▊      | 38/100 [27:51<48:08, 46.59s/it]Evaluating steering:  39%|███▉      | 39/100 [29:25<1:01:49, 60.82s/it]Evaluating steering:  40%|████      | 40/100 [30:02<53:33, 53.56s/it]  Evaluating steering:  41%|████      | 41/100 [30:43<48:53, 49.72s/it]Evaluating steering:  42%|████▏     | 42/100 [31:38<49:46, 51.49s/it]Evaluating steering:  43%|████▎     | 43/100 [32:16<44:59, 47.35s/it]Evaluating steering:  44%|████▍     | 44/100 [33:37<53:45, 57.60s/it]Evaluating steering:  45%|████▌     | 45/100 [35:11<1:02:37, 68.32s/it]Evaluating steering:  46%|████▌     | 46/100 [36:46<1:08:47, 76.44s/it]Evaluating steering:  47%|████▋     | 47/100 [37:29<58:30, 66.24s/it]  Evaluating steering:  48%|████▊     | 48/100 [38:12<51:36, 59.55s/it]Evaluating steering:  49%|████▉     | 49/100 [38:58<46:55, 55.20s/it]Evaluating steering:  50%|█████     | 50/100 [39:25<39:09, 46.99s/it]Evaluating steering:  51%|█████     | 51/100 [41:04<51:06, 62.57s/it]Evaluating steering:  52%|█████▏    | 52/100 [41:32<41:40, 52.10s/it]Evaluating steering:  53%|█████▎    | 53/100 [42:41<44:43, 57.09s/it]Evaluating steering:  54%|█████▍    | 54/100 [44:01<49:06, 64.05s/it]Evaluating steering:  55%|█████▌    | 55/100 [45:02<47:19, 63.09s/it]Evaluating steering:  56%|█████▌    | 56/100 [45:44<41:41, 56.85s/it]Evaluating steering:  57%|█████▋    | 57/100 [46:21<36:23, 50.78s/it]Evaluating steering:  58%|█████▊    | 58/100 [47:58<45:18, 64.72s/it]Evaluating steering:  59%|█████▉    | 59/100 [48:45<40:32, 59.34s/it]Evaluating steering:  60%|██████    | 60/100 [49:25<35:41, 53.54s/it]Evaluating steering:  61%|██████    | 61/100 [50:04<32:02, 49.31s/it]Evaluating steering:  62%|██████▏   | 62/100 [50:51<30:46, 48.60s/it]Evaluating steering:  63%|██████▎   | 63/100 [51:29<28:04, 45.53s/it]Evaluating steering:  64%|██████▍   | 64/100 [52:46<32:50, 54.73s/it]Evaluating steering:  65%|██████▌   | 65/100 [53:34<30:49, 52.84s/it]Evaluating steering:  66%|██████▌   | 66/100 [54:02<25:37, 45.21s/it]Evaluating steering:  67%|██████▋   | 67/100 [54:45<24:32, 44.62s/it]Evaluating steering:  68%|██████▊   | 68/100 [55:38<25:10, 47.20s/it]Evaluating steering:  69%|██████▉   | 69/100 [56:30<25:09, 48.69s/it]Evaluating steering:  70%|███████   | 70/100 [57:09<22:52, 45.74s/it]Evaluating steering:  71%|███████   | 71/100 [58:01<22:58, 47.53s/it]Evaluating steering:  72%|███████▏  | 72/100 [58:41<21:08, 45.31s/it]Evaluating steering:  73%|███████▎  | 73/100 [59:18<19:14, 42.77s/it]Evaluating steering:  74%|███████▍  | 74/100 [1:00:51<25:07, 57.97s/it]Evaluating steering:  75%|███████▌  | 75/100 [1:02:30<29:17, 70.32s/it]Evaluating steering:  76%|███████▌  | 76/100 [1:03:12<24:38, 61.61s/it]Evaluating steering:  77%|███████▋  | 77/100 [1:04:35<26:04, 68.02s/it]Evaluating steering:  78%|███████▊  | 78/100 [1:05:08<21:09, 57.72s/it]Evaluating steering:  79%|███████▉  | 79/100 [1:05:32<16:40, 47.65s/it]Evaluating steering:  80%|████████  | 80/100 [1:05:58<13:38, 40.92s/it]Evaluating steering:  81%|████████  | 81/100 [1:06:37<12:51, 40.59s/it]Evaluating steering:  82%|████████▏ | 82/100 [1:07:32<13:26, 44.81s/it]Evaluating steering:  83%|████████▎ | 83/100 [1:08:09<12:03, 42.58s/it]Evaluating steering:  84%|████████▍ | 84/100 [1:08:53<11:25, 42.85s/it]Evaluating steering:  85%|████████▌ | 85/100 [1:09:03<08:14, 32.94s/it]Evaluating steering:  86%|████████▌ | 86/100 [1:09:37<07:48, 33.44s/it]Evaluating steering:  87%|████████▋ | 87/100 [1:10:22<07:58, 36.77s/it]Evaluating steering:  88%|████████▊ | 88/100 [1:10:58<07:19, 36.64s/it]Evaluating steering:  89%|████████▉ | 89/100 [1:11:27<06:17, 34.29s/it]Evaluating steering:  90%|█████████ | 90/100 [1:12:09<06:07, 36.72s/it]Evaluating steering:  91%|█████████ | 91/100 [1:13:31<07:31, 50.18s/it]Evaluating steering:  92%|█████████▏| 92/100 [1:14:06<06:04, 45.51s/it]Evaluating steering:  93%|█████████▎| 93/100 [1:14:59<05:34, 47.78s/it]Evaluating steering:  94%|█████████▍| 94/100 [1:15:58<05:07, 51.20s/it]Evaluating steering:  95%|█████████▌| 95/100 [1:16:27<03:42, 44.55s/it]Evaluating steering:  96%|█████████▌| 96/100 [1:16:57<02:41, 40.29s/it]Evaluating steering:  97%|█████████▋| 97/100 [1:18:25<02:43, 54.50s/it]Evaluating steering:  98%|█████████▊| 98/100 [1:19:07<01:41, 50.81s/it]Evaluating steering:  99%|█████████▉| 99/100 [1:19:59<00:51, 51.03s/it]Evaluating steering: 100%|██████████| 100/100 [1:20:46<00:00, 49.95s/it]Evaluating steering: 100%|██████████| 100/100 [1:20:46<00:00, 48.47s/it]
2025-12-11 17:27:24,692 | INFO | Saved evaluation results to /nobackup/bdeka/huggingface_cache/artifacts/steering_evaluation_out_of_sample/steering_evaluation_results_offset100.json
2025-12-11 17:27:24,692 | INFO | ============================================================
2025-12-11 17:27:24,692 | INFO | Steering Evaluation Results
2025-12-11 17:27:24,692 | INFO | ============================================================
2025-12-11 17:27:24,692 | INFO | Total triples evaluated: 100
2025-12-11 17:27:24,693 | INFO | 
2025-12-11 17:27:24,693 | INFO | Without steering:
2025-12-11 17:27:24,693 | INFO |   Correct: 7
2025-12-11 17:27:24,693 | INFO |   Incorrect: 93
2025-12-11 17:27:24,693 | INFO |   Accuracy: 7.00%
2025-12-11 17:27:24,693 | INFO | 
2025-12-11 17:27:24,693 | INFO | With steering (coefficient=1.00):
2025-12-11 17:27:24,693 | INFO |   Correct: 26
2025-12-11 17:27:24,693 | INFO |   Incorrect: 74
2025-12-11 17:27:24,693 | INFO |   Accuracy: 26.00%
2025-12-11 17:27:24,693 | INFO | 
2025-12-11 17:27:24,693 | INFO | Improvements (wrong -> correct): 24
2025-12-11 17:27:24,693 | INFO | Degradations (correct -> wrong): 5
2025-12-11 17:27:24,693 | INFO | 
2025-12-11 17:27:24,693 | INFO | Accuracy change: +19.00%
2025-12-11 17:27:24,693 | INFO | ============================================================
With steering: H
results['with_steering']['correct']: 0
With steering: C
results['with_steering']['correct']: 0
With steering: E
results['with_steering']['correct']: 0
With steering: A
results['with_steering']['correct']: 0
With steering: F
results['with_steering']['correct']: 0
With steering: H
results['with_steering']['correct']: 0
With steering: J
results['with_steering']['correct']: 0
With steering: C
results['with_steering']['correct']: 1
With steering: (106 + 54r) / (R^3 + 18R^2 + 81R + 9R^2 +
results['with_steering']['correct']: 1
With steering: A
results['with_steering']['correct']: 1
With steering: H
results['with_steering']['correct']: 2
With steering: E
results['with_steering']['correct']: 2
With steering: This can also be expressed as (p1  and (p_2  not p_3  not p_4) and (p_2 and (p_1 not p_3  p4) and (p3  and (p_4  not p_1  not p_2) and (p_4 and (p_1 p_2  not p3)  or (not p_1 and p2 and p_4 and (p1  and   p_3  not  p_
results['with_steering']['correct']: 2
With steering: A
results['with_steering']['correct']: 2
With steering: B
results['with_steering']['correct']: 2
With steering: A
results['with_steering']['correct']: 3
With steering: H
results['with_steering']['correct']: 4
With steering: E
results['with_steering']['correct']: 4
With steering: I
results['with_steering']['correct']: 4
With steering: F
results['with_steering']['correct']: 4
With steering: F
results['with_steering']['correct']: 4
With steering: i
results['with_steering']['correct']: 4
With steering: H
results['with_steering']['correct']: 4
With steering: A
results['with_steering']['correct']: 4
With steering: E
results['with_steering']['correct']: 4
With steering: B
results['with_steering']['correct']: 4
With steering: F
results['with_steering']['correct']: 4
With steering: i
results['with_steering']['correct']: 4
With steering: i
results['with_steering']['correct']: 4
With steering: H
results['with_steering']['correct']: 4
With steering: I
results['with_steering']['correct']: 4
With steering: E
results['with_steering']['correct']: 4
With steering: C
results['with_steering']['correct']: 5
With steering: C
results['with_steering']['correct']: 5
With steering: J
results['with_steering']['correct']: 5
With steering: B
results['with_steering']['correct']: 5
With steering: C
results['with_steering']['correct']: 5
With steering: F
results['with_steering']['correct']: 6
With steering: \[ \text {Energy in kcal/mol} = 80.08  \, \text {
results['with_steering']['correct']: 6
With steering: G
results['with_steering']['correct']: 7
With steering: G
results['with_steering']['correct']: 7
With steering: B
results['with_steering']['correct']: 7
With steering: A
results['with_steering']['correct']: 7
With steering: B
results['with_steering']['correct']: 7
With steering: The ratio of the Reynolds numbers is not equal to
results['with_steering']['correct']: 7
With steering: i
results['with_steering']['correct']: 7
With steering: D
results['with_steering']['correct']: 8
With steering: F
results['with_steering']['correct']: 9
With steering: C
results['with_steering']['correct']: 10
With steering: H
results['with_steering']['correct']: 10
With steering: The partial pressure of  Na is then 3.10/4.256 * 10.0. However, this
results['with_steering']['correct']: 10
With steering: D
results['with_steering']['correct']: 10
With steering: f = 0.16
results['with_steering']['correct']: 10
With steering: J
results['with_steering']['correct']: 10
With steering: B
results['with_steering']['correct']: 10
With steering: E
results['with_steering']['correct']: 10
With steering: D
results['with_steering']['correct']: 10
With steering: \[ T_s = 60008.0 R = 60008.000 \frac 9 {5} = 108000.16 \frac 9 {9} = 120000.18 \frac 5 {9} = 66666.67 \frac 9 {18} = 3700.37
results['with_steering']['correct']: 10
With steering: F
results['with_steering']['correct']: 10
With steering: A
results['with_steering']['correct']: 11
With steering: J
results['with_steering']['correct']: 11
With steering: E
results['with_steering']['correct']: 11
With steering: B
results['with_steering']['correct']: 11
With steering: B
results['with_steering']['correct']: 11
With steering: C
results['with_steering']['correct']: 11
With steering: F
results['with_steering']['correct']: 11
With steering: B
results['with_steering']['correct']: 12
With steering: J
results['with_steering']['correct']: 13
With steering: C
results['with_steering']['correct']: 13
With steering: J
results['with_steering']['correct']: 14
With steering: C
results['with_steering']['correct']: 14
With steering: I
results['with_steering']['correct']: 14
With steering: A
results['with_steering']['correct']: 15
With steering: H
results['with_steering']['correct']: 16
With steering: \[ \tau = \frac{r\frac{dp}{d x
results['with_steering']['correct']: 16
With steering: D
results['with_steering']['correct']: 16
With steering: A
results['with_steering']['correct']: 16
With steering: E
results['with_steering']['correct']: 17
With steering: H
results['with_steering']['correct']: 17
With steering: B
results['with_steering']['correct']: 18
With steering: F
results['with_steering']['correct']: 18
With steering: G
results['with_steering']['correct']: 19
With steering: E
results['with_steering']['correct']: 20
With steering: F
results['with_steering']['correct']: 20
With steering: C
results['with_steering']['correct']: 21
With steering: F
results['with_steering']['correct']: 21
With steering: J
results['with_steering']['correct']: 21
With steering: J
results['with_steering']['correct']: 21
With steering: A
results['with_steering']['correct']: 22
With steering: A
results['with_steering']['correct']: 22
With steering: i
results['with_steering']['correct']: 22
With steering: D
results['with_steering']['correct']: 22
With steering: A
results['with_steering']['correct']: 23
With steering: s
results['with_steering']['correct']: 23
With steering: C
results['with_steering']['correct']: 23
With steering: F
results['with_steering']['correct']: 24
With steering: For x = 12, 3^12 - 12^2 = 531441 - 144
results['with_steering']['correct']: 24
With steering: i
results['with_steering']['correct']: 24
With steering: A
results['with_steering']['correct']: 25
With steering: C
results['with_steering']['correct']: 26
Steering evaluation complete. Results saved to /nobackup/bdeka/huggingface_cache/artifacts/steering_evaluation_in_sample and /nobackup/bdeka/huggingface_cache/artifacts/steering_evaluation_out_of_sample
=== Step 8: Comparing embeddings with and without steering ===
Comparing embeddings for layer 29...
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/transformers/utils/hub.py:127: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
2025-12-11 17:27:36,636 | INFO | Loaded 100 triples for comparison
2025-12-11 17:27:36,638 | INFO | Loaded steering vector for layer 29 (shape: (4096,), norm: 19.0103)
2025-12-11 17:27:36,669 | INFO | Loading model meta-llama/Llama-3.1-8B-Instruct on cuda with dtype torch.float16
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 15128.24it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:07,  2.63s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.46s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:07<00:02,  2.28s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.61s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.91s/it]
2025-12-11 17:27:47,023 | INFO | Collecting correct embeddings (prompt + correct_chain)... [offset=0, max=100]
Collecting hidden states:   0%|          | 0/100 [00:00<?, ?it/s]Collecting hidden states:   1%|          | 1/100 [00:01<02:24,  1.46s/it]Collecting hidden states:   2%|▏         | 2/100 [00:01<01:16,  1.28it/s]Collecting hidden states:   3%|▎         | 3/100 [00:01<00:51,  1.89it/s]Collecting hidden states:   4%|▍         | 4/100 [00:02<00:36,  2.65it/s]Collecting hidden states:   5%|▌         | 5/100 [00:02<00:37,  2.54it/s]Collecting hidden states:   6%|▌         | 6/100 [00:03<00:50,  1.87it/s]Collecting hidden states:   7%|▋         | 7/100 [00:03<00:42,  2.20it/s]Collecting hidden states:   8%|▊         | 8/100 [00:03<00:34,  2.66it/s]Collecting hidden states:   9%|▉         | 9/100 [00:04<00:27,  3.29it/s]Collecting hidden states:  10%|█         | 10/100 [00:04<00:25,  3.53it/s]Collecting hidden states:  11%|█         | 11/100 [00:04<00:23,  3.85it/s]Collecting hidden states:  12%|█▏        | 12/100 [00:04<00:19,  4.55it/s]Collecting hidden states:  13%|█▎        | 13/100 [00:04<00:20,  4.18it/s]Collecting hidden states:  14%|█▍        | 14/100 [00:05<00:25,  3.34it/s]Collecting hidden states:  15%|█▌        | 15/100 [00:05<00:30,  2.80it/s]Collecting hidden states:  16%|█▌        | 16/100 [00:06<00:32,  2.61it/s]Collecting hidden states:  17%|█▋        | 17/100 [00:06<00:32,  2.59it/s]Collecting hidden states:  18%|█▊        | 18/100 [00:06<00:29,  2.79it/s]Collecting hidden states:  19%|█▉        | 19/100 [00:07<00:24,  3.37it/s]Collecting hidden states:  20%|██        | 20/100 [00:07<00:27,  2.96it/s]Collecting hidden states:  21%|██        | 21/100 [00:07<00:24,  3.23it/s]Collecting hidden states:  22%|██▏       | 22/100 [00:08<00:22,  3.45it/s]Collecting hidden states:  23%|██▎       | 23/100 [00:08<00:21,  3.61it/s]Collecting hidden states:  24%|██▍       | 24/100 [00:08<00:19,  3.83it/s]Collecting hidden states:  25%|██▌       | 25/100 [00:08<00:22,  3.35it/s]Collecting hidden states:  26%|██▌       | 26/100 [00:09<00:22,  3.36it/s]Collecting hidden states:  27%|██▋       | 27/100 [00:09<00:18,  3.90it/s]Collecting hidden states:  28%|██▊       | 28/100 [00:09<00:19,  3.73it/s]Collecting hidden states:  29%|██▉       | 29/100 [00:09<00:18,  3.87it/s]Collecting hidden states:  30%|███       | 30/100 [00:10<00:18,  3.72it/s]Collecting hidden states:  31%|███       | 31/100 [00:10<00:21,  3.17it/s]Collecting hidden states:  32%|███▏      | 32/100 [00:11<00:30,  2.25it/s]Collecting hidden states:  33%|███▎      | 33/100 [00:11<00:29,  2.29it/s]Collecting hidden states:  34%|███▍      | 34/100 [00:11<00:23,  2.84it/s]Collecting hidden states:  35%|███▌      | 35/100 [00:12<00:20,  3.23it/s]Collecting hidden states:  36%|███▌      | 36/100 [00:12<00:19,  3.30it/s]Collecting hidden states:  37%|███▋      | 37/100 [00:12<00:23,  2.68it/s]Collecting hidden states:  38%|███▊      | 38/100 [00:13<00:23,  2.67it/s]Collecting hidden states:  39%|███▉      | 39/100 [00:13<00:20,  2.98it/s]Collecting hidden states:  40%|████      | 40/100 [00:13<00:20,  2.89it/s]Collecting hidden states:  41%|████      | 41/100 [00:14<00:16,  3.48it/s]Collecting hidden states:  42%|████▏     | 42/100 [00:14<00:16,  3.42it/s]Collecting hidden states:  43%|████▎     | 43/100 [00:15<00:23,  2.45it/s]Collecting hidden states:  44%|████▍     | 44/100 [00:15<00:18,  3.05it/s]Collecting hidden states:  45%|████▌     | 45/100 [00:15<00:18,  2.94it/s]Collecting hidden states:  46%|████▌     | 46/100 [00:15<00:16,  3.30it/s]Collecting hidden states:  47%|████▋     | 47/100 [00:16<00:14,  3.55it/s]Collecting hidden states:  48%|████▊     | 48/100 [00:16<00:16,  3.09it/s]Collecting hidden states:  49%|████▉     | 49/100 [00:16<00:14,  3.43it/s]Collecting hidden states:  50%|█████     | 50/100 [00:17<00:15,  3.16it/s]Collecting hidden states:  51%|█████     | 51/100 [00:17<00:18,  2.67it/s]Collecting hidden states:  52%|█████▏    | 52/100 [00:17<00:17,  2.67it/s]Collecting hidden states:  53%|█████▎    | 53/100 [00:19<00:28,  1.65it/s]Collecting hidden states:  54%|█████▍    | 54/100 [00:19<00:24,  1.90it/s]Collecting hidden states:  55%|█████▌    | 55/100 [00:19<00:20,  2.23it/s]Collecting hidden states:  56%|█████▌    | 56/100 [00:19<00:17,  2.54it/s]Collecting hidden states:  57%|█████▋    | 57/100 [00:20<00:20,  2.10it/s]Collecting hidden states:  58%|█████▊    | 58/100 [00:21<00:24,  1.74it/s]Collecting hidden states:  59%|█████▉    | 59/100 [00:21<00:18,  2.24it/s]Collecting hidden states:  60%|██████    | 60/100 [00:21<00:15,  2.67it/s]Collecting hidden states:  61%|██████    | 61/100 [00:22<00:13,  2.87it/s]Collecting hidden states:  62%|██████▏   | 62/100 [00:22<00:13,  2.87it/s]Collecting hidden states:  63%|██████▎   | 63/100 [00:22<00:13,  2.73it/s]Collecting hidden states:  64%|██████▍   | 64/100 [00:23<00:12,  2.89it/s]Collecting hidden states:  65%|██████▌   | 65/100 [00:23<00:13,  2.53it/s]Collecting hidden states:  66%|██████▌   | 66/100 [00:23<00:10,  3.10it/s]Collecting hidden states:  67%|██████▋   | 67/100 [00:24<00:11,  2.81it/s]Collecting hidden states:  68%|██████▊   | 68/100 [00:24<00:12,  2.48it/s]Collecting hidden states:  69%|██████▉   | 69/100 [00:25<00:15,  1.96it/s]Collecting hidden states:  70%|███████   | 70/100 [00:25<00:12,  2.37it/s]Collecting hidden states:  71%|███████   | 71/100 [00:26<00:13,  2.23it/s]Collecting hidden states:  72%|███████▏  | 72/100 [00:26<00:15,  1.83it/s]Collecting hidden states:  73%|███████▎  | 73/100 [00:27<00:12,  2.22it/s]Collecting hidden states:  74%|███████▍  | 74/100 [00:27<00:11,  2.34it/s]Collecting hidden states:  75%|███████▌  | 75/100 [00:27<00:09,  2.55it/s]Collecting hidden states:  76%|███████▌  | 76/100 [00:28<00:08,  2.94it/s]Collecting hidden states:  77%|███████▋  | 77/100 [00:28<00:07,  3.27it/s]Collecting hidden states:  78%|███████▊  | 78/100 [00:28<00:06,  3.25it/s]Collecting hidden states:  79%|███████▉  | 79/100 [00:28<00:05,  3.78it/s]Collecting hidden states:  80%|████████  | 80/100 [00:29<00:06,  3.00it/s]Collecting hidden states:  81%|████████  | 81/100 [00:29<00:06,  2.89it/s]Collecting hidden states:  82%|████████▏ | 82/100 [00:29<00:05,  3.22it/s]Collecting hidden states:  83%|████████▎ | 83/100 [00:30<00:04,  3.78it/s]Collecting hidden states:  84%|████████▍ | 84/100 [00:30<00:04,  3.98it/s]Collecting hidden states:  85%|████████▌ | 85/100 [00:30<00:03,  4.12it/s]Collecting hidden states:  86%|████████▌ | 86/100 [00:30<00:04,  3.32it/s]Collecting hidden states:  87%|████████▋ | 87/100 [00:31<00:04,  3.10it/s]Collecting hidden states:  88%|████████▊ | 88/100 [00:31<00:04,  2.93it/s]Collecting hidden states:  89%|████████▉ | 89/100 [00:32<00:03,  2.80it/s]Collecting hidden states:  90%|█████████ | 90/100 [00:32<00:03,  2.61it/s]Collecting hidden states:  91%|█████████ | 91/100 [00:32<00:03,  2.98it/s]Collecting hidden states:  92%|█████████▏| 92/100 [00:32<00:02,  3.30it/s]Collecting hidden states:  93%|█████████▎| 93/100 [00:33<00:02,  3.32it/s]Collecting hidden states:  94%|█████████▍| 94/100 [00:33<00:01,  3.03it/s]Collecting hidden states:  95%|█████████▌| 95/100 [00:33<00:01,  3.09it/s]Collecting hidden states:  96%|█████████▌| 96/100 [00:34<00:01,  2.94it/s]Collecting hidden states:  97%|█████████▋| 97/100 [00:34<00:00,  3.00it/s]Collecting hidden states:  98%|█████████▊| 98/100 [00:34<00:00,  3.06it/s]Collecting hidden states:  99%|█████████▉| 99/100 [00:35<00:00,  3.32it/s]Collecting hidden states: 100%|██████████| 100/100 [00:35<00:00,  3.57it/s]Collecting hidden states: 100%|██████████| 100/100 [00:35<00:00,  2.82it/s]
2025-12-11 17:28:22,484 | INFO | Collected 100 correct embeddings (shape: (100, 4096))
2025-12-11 17:28:22,484 | INFO | Collecting wrong embeddings without steering (prompt only)...
Collecting hidden states:   0%|          | 0/100 [00:00<?, ?it/s]Collecting hidden states:   1%|          | 1/100 [00:00<00:56,  1.74it/s]Collecting hidden states:   2%|▏         | 2/100 [00:00<00:35,  2.74it/s]Collecting hidden states:   3%|▎         | 3/100 [00:00<00:25,  3.87it/s]Collecting hidden states:   5%|▌         | 5/100 [00:01<00:21,  4.47it/s]Collecting hidden states:   6%|▌         | 6/100 [00:01<00:19,  4.89it/s]Collecting hidden states:   7%|▋         | 7/100 [00:01<00:17,  5.46it/s]Collecting hidden states:   8%|▊         | 8/100 [00:01<00:15,  5.76it/s]Collecting hidden states:   9%|▉         | 9/100 [00:01<00:14,  6.18it/s]Collecting hidden states:  10%|█         | 10/100 [00:02<00:14,  6.20it/s]Collecting hidden states:  11%|█         | 11/100 [00:02<00:13,  6.46it/s]Collecting hidden states:  13%|█▎        | 13/100 [00:02<00:12,  7.06it/s]Collecting hidden states:  14%|█▍        | 14/100 [00:02<00:15,  5.52it/s]Collecting hidden states:  15%|█▌        | 15/100 [00:02<00:16,  5.23it/s]Collecting hidden states:  16%|█▌        | 16/100 [00:03<00:16,  4.98it/s]Collecting hidden states:  17%|█▋        | 17/100 [00:03<00:20,  4.02it/s]Collecting hidden states:  18%|█▊        | 18/100 [00:03<00:17,  4.59it/s]Collecting hidden states:  19%|█▉        | 19/100 [00:03<00:15,  5.21it/s]Collecting hidden states:  20%|██        | 20/100 [00:04<00:16,  4.92it/s]Collecting hidden states:  22%|██▏       | 22/100 [00:04<00:14,  5.51it/s]Collecting hidden states:  23%|██▎       | 23/100 [00:04<00:13,  5.90it/s]Collecting hidden states:  24%|██▍       | 24/100 [00:04<00:12,  6.22it/s]Collecting hidden states:  25%|██▌       | 25/100 [00:04<00:14,  5.02it/s]Collecting hidden states:  26%|██▌       | 26/100 [00:05<00:13,  5.32it/s]Collecting hidden states:  27%|██▋       | 27/100 [00:05<00:12,  5.76it/s]Collecting hidden states:  28%|██▊       | 28/100 [00:05<00:13,  5.34it/s]Collecting hidden states:  29%|██▉       | 29/100 [00:05<00:12,  5.62it/s]Collecting hidden states:  30%|███       | 30/100 [00:05<00:11,  6.10it/s]Collecting hidden states:  31%|███       | 31/100 [00:05<00:12,  5.43it/s]Collecting hidden states:  32%|███▏      | 32/100 [00:06<00:11,  5.93it/s]Collecting hidden states:  33%|███▎      | 33/100 [00:06<00:11,  5.96it/s]Collecting hidden states:  34%|███▍      | 34/100 [00:06<00:10,  6.36it/s]Collecting hidden states:  35%|███▌      | 35/100 [00:06<00:09,  6.72it/s]Collecting hidden states:  36%|███▌      | 36/100 [00:06<00:10,  5.86it/s]Collecting hidden states:  37%|███▋      | 37/100 [00:07<00:16,  3.72it/s]Collecting hidden states:  38%|███▊      | 38/100 [00:07<00:14,  4.29it/s]Collecting hidden states:  39%|███▉      | 39/100 [00:07<00:13,  4.38it/s]Collecting hidden states:  40%|████      | 40/100 [00:07<00:13,  4.34it/s]Collecting hidden states:  42%|████▏     | 42/100 [00:08<00:10,  5.45it/s]Collecting hidden states:  43%|████▎     | 43/100 [00:08<00:11,  5.08it/s]Collecting hidden states:  44%|████▍     | 44/100 [00:08<00:10,  5.57it/s]Collecting hidden states:  45%|████▌     | 45/100 [00:08<00:10,  5.05it/s]Collecting hidden states:  46%|████▌     | 46/100 [00:08<00:09,  5.57it/s]Collecting hidden states:  47%|████▋     | 47/100 [00:09<00:09,  5.77it/s]Collecting hidden states:  48%|████▊     | 48/100 [00:09<00:12,  4.32it/s]Collecting hidden states:  49%|████▉     | 49/100 [00:09<00:10,  4.94it/s]Collecting hidden states:  50%|█████     | 50/100 [00:09<00:10,  4.70it/s]Collecting hidden states:  51%|█████     | 51/100 [00:09<00:09,  5.16it/s]Collecting hidden states:  52%|█████▏    | 52/100 [00:10<00:08,  5.45it/s]Collecting hidden states:  53%|█████▎    | 53/100 [00:10<00:07,  5.96it/s]Collecting hidden states:  54%|█████▍    | 54/100 [00:10<00:08,  5.28it/s]Collecting hidden states:  55%|█████▌    | 55/100 [00:10<00:10,  4.49it/s]Collecting hidden states:  56%|█████▌    | 56/100 [00:10<00:08,  4.98it/s]Collecting hidden states:  57%|█████▋    | 57/100 [00:11<00:09,  4.36it/s]Collecting hidden states:  58%|█████▊    | 58/100 [00:11<00:11,  3.57it/s]Collecting hidden states:  60%|██████    | 60/100 [00:11<00:08,  4.86it/s]Collecting hidden states:  61%|██████    | 61/100 [00:11<00:07,  5.16it/s]Collecting hidden states:  62%|██████▏   | 62/100 [00:12<00:07,  5.03it/s]Collecting hidden states:  63%|██████▎   | 63/100 [00:12<00:09,  4.01it/s]Collecting hidden states:  64%|██████▍   | 64/100 [00:12<00:08,  4.06it/s]Collecting hidden states:  65%|██████▌   | 65/100 [00:13<00:09,  3.85it/s]Collecting hidden states:  66%|██████▌   | 66/100 [00:13<00:07,  4.51it/s]Collecting hidden states:  67%|██████▋   | 67/100 [00:13<00:07,  4.47it/s]Collecting hidden states:  68%|██████▊   | 68/100 [00:13<00:07,  4.52it/s]Collecting hidden states:  69%|██████▉   | 69/100 [00:14<00:08,  3.70it/s]Collecting hidden states:  70%|███████   | 70/100 [00:14<00:07,  4.26it/s]Collecting hidden states:  71%|███████   | 71/100 [00:14<00:06,  4.75it/s]Collecting hidden states:  72%|███████▏  | 72/100 [00:14<00:06,  4.64it/s]Collecting hidden states:  73%|███████▎  | 73/100 [00:14<00:05,  5.02it/s]Collecting hidden states:  74%|███████▍  | 74/100 [00:15<00:06,  4.27it/s]Collecting hidden states:  75%|███████▌  | 75/100 [00:15<00:05,  4.72it/s]Collecting hidden states:  76%|███████▌  | 76/100 [00:15<00:04,  5.18it/s]Collecting hidden states:  77%|███████▋  | 77/100 [00:15<00:04,  5.67it/s]Collecting hidden states:  78%|███████▊  | 78/100 [00:15<00:04,  5.22it/s]Collecting hidden states:  79%|███████▉  | 79/100 [00:15<00:03,  5.53it/s]Collecting hidden states:  80%|████████  | 80/100 [00:16<00:05,  3.96it/s]Collecting hidden states:  81%|████████  | 81/100 [00:16<00:04,  4.01it/s]Collecting hidden states:  82%|████████▏ | 82/100 [00:16<00:04,  4.46it/s]Collecting hidden states:  83%|████████▎ | 83/100 [00:16<00:03,  5.05it/s]Collecting hidden states:  84%|████████▍ | 84/100 [00:17<00:02,  5.35it/s]Collecting hidden states:  85%|████████▌ | 85/100 [00:17<00:02,  5.69it/s]Collecting hidden states:  86%|████████▌ | 86/100 [00:17<00:02,  5.14it/s]Collecting hidden states:  87%|████████▋ | 87/100 [00:17<00:02,  5.73it/s]Collecting hidden states:  88%|████████▊ | 88/100 [00:17<00:02,  4.91it/s]Collecting hidden states:  89%|████████▉ | 89/100 [00:17<00:02,  5.28it/s]Collecting hidden states:  90%|█████████ | 90/100 [00:18<00:01,  5.57it/s]Collecting hidden states:  91%|█████████ | 91/100 [00:18<00:01,  6.05it/s]Collecting hidden states:  92%|█████████▏| 92/100 [00:18<00:01,  6.17it/s]Collecting hidden states:  93%|█████████▎| 93/100 [00:18<00:01,  6.56it/s]Collecting hidden states:  94%|█████████▍| 94/100 [00:18<00:01,  5.18it/s]Collecting hidden states:  95%|█████████▌| 95/100 [00:18<00:00,  5.54it/s]Collecting hidden states:  96%|█████████▌| 96/100 [00:19<00:00,  5.80it/s]Collecting hidden states:  97%|█████████▋| 97/100 [00:19<00:00,  4.80it/s]Collecting hidden states:  98%|█████████▊| 98/100 [00:19<00:00,  5.34it/s]Collecting hidden states:  99%|█████████▉| 99/100 [00:19<00:00,  5.64it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  5.89it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  5.03it/s]
2025-12-11 17:28:42,370 | INFO | Collected 100 wrong embeddings without steering (shape: (100, 4096))
2025-12-11 17:28:42,371 | INFO | Collecting wrong embeddings with steering (simulated by adding steering vector)...
Collecting hidden states:   0%|          | 0/100 [00:00<?, ?it/s]Collecting hidden states:   2%|▏         | 2/100 [00:00<00:14,  6.70it/s]Collecting hidden states:   3%|▎         | 3/100 [00:00<00:13,  7.03it/s]Collecting hidden states:   4%|▍         | 4/100 [00:00<00:12,  7.85it/s]Collecting hidden states:   5%|▌         | 5/100 [00:00<00:18,  5.26it/s]Collecting hidden states:   6%|▌         | 6/100 [00:01<00:16,  5.56it/s]Collecting hidden states:   7%|▋         | 7/100 [00:01<00:15,  6.08it/s]Collecting hidden states:   8%|▊         | 8/100 [00:01<00:14,  6.26it/s]Collecting hidden states:   9%|▉         | 9/100 [00:01<00:13,  6.58it/s]Collecting hidden states:  10%|█         | 10/100 [00:01<00:13,  6.48it/s]Collecting hidden states:  11%|█         | 11/100 [00:01<00:13,  6.65it/s]Collecting hidden states:  13%|█▎        | 13/100 [00:01<00:11,  7.37it/s]Collecting hidden states:  14%|█▍        | 14/100 [00:02<00:15,  5.71it/s]Collecting hidden states:  15%|█▌        | 15/100 [00:02<00:15,  5.39it/s]Collecting hidden states:  16%|█▌        | 16/100 [00:02<00:16,  5.13it/s]Collecting hidden states:  17%|█▋        | 17/100 [00:03<00:20,  4.10it/s]Collecting hidden states:  18%|█▊        | 18/100 [00:03<00:17,  4.72it/s]Collecting hidden states:  19%|█▉        | 19/100 [00:03<00:15,  5.34it/s]Collecting hidden states:  20%|██        | 20/100 [00:03<00:16,  4.98it/s]Collecting hidden states:  22%|██▏       | 22/100 [00:03<00:14,  5.26it/s]Collecting hidden states:  23%|██▎       | 23/100 [00:04<00:13,  5.71it/s]Collecting hidden states:  24%|██▍       | 24/100 [00:04<00:12,  6.07it/s]Collecting hidden states:  25%|██▌       | 25/100 [00:04<00:15,  4.97it/s]Collecting hidden states:  26%|██▌       | 26/100 [00:04<00:13,  5.29it/s]Collecting hidden states:  27%|██▋       | 27/100 [00:04<00:12,  5.71it/s]Collecting hidden states:  28%|██▊       | 28/100 [00:04<00:13,  5.32it/s]Collecting hidden states:  29%|██▉       | 29/100 [00:05<00:12,  5.61it/s]Collecting hidden states:  30%|███       | 30/100 [00:05<00:11,  6.10it/s]Collecting hidden states:  31%|███       | 31/100 [00:05<00:12,  5.44it/s]Collecting hidden states:  32%|███▏      | 32/100 [00:05<00:11,  5.95it/s]Collecting hidden states:  33%|███▎      | 33/100 [00:05<00:11,  6.08it/s]Collecting hidden states:  34%|███▍      | 34/100 [00:05<00:10,  6.47it/s]Collecting hidden states:  35%|███▌      | 35/100 [00:06<00:09,  6.73it/s]Collecting hidden states:  36%|███▌      | 36/100 [00:06<00:10,  5.89it/s]Collecting hidden states:  37%|███▋      | 37/100 [00:06<00:16,  3.79it/s]Collecting hidden states:  38%|███▊      | 38/100 [00:06<00:14,  4.35it/s]Collecting hidden states:  39%|███▉      | 39/100 [00:07<00:14,  4.33it/s]Collecting hidden states:  40%|████      | 40/100 [00:07<00:13,  4.30it/s]Collecting hidden states:  42%|████▏     | 42/100 [00:07<00:10,  5.58it/s]Collecting hidden states:  43%|████▎     | 43/100 [00:07<00:10,  5.20it/s]Collecting hidden states:  44%|████▍     | 44/100 [00:07<00:09,  5.67it/s]Collecting hidden states:  45%|████▌     | 45/100 [00:08<00:10,  5.15it/s]Collecting hidden states:  46%|████▌     | 46/100 [00:08<00:09,  5.67it/s]Collecting hidden states:  47%|████▋     | 47/100 [00:08<00:08,  5.90it/s]Collecting hidden states:  48%|████▊     | 48/100 [00:08<00:11,  4.39it/s]Collecting hidden states:  49%|████▉     | 49/100 [00:09<00:10,  4.97it/s]Collecting hidden states:  50%|█████     | 50/100 [00:09<00:10,  4.74it/s]Collecting hidden states:  51%|█████     | 51/100 [00:09<00:09,  5.32it/s]Collecting hidden states:  52%|█████▏    | 52/100 [00:09<00:08,  5.47it/s]Collecting hidden states:  53%|█████▎    | 53/100 [00:09<00:07,  5.95it/s]Collecting hidden states:  54%|█████▍    | 54/100 [00:09<00:08,  5.35it/s]Collecting hidden states:  55%|█████▌    | 55/100 [00:10<00:09,  4.55it/s]Collecting hidden states:  56%|█████▌    | 56/100 [00:10<00:08,  5.01it/s]Collecting hidden states:  57%|█████▋    | 57/100 [00:10<00:09,  4.37it/s]Collecting hidden states:  58%|█████▊    | 58/100 [00:11<00:11,  3.61it/s]Collecting hidden states:  60%|██████    | 60/100 [00:11<00:08,  4.88it/s]Collecting hidden states:  61%|██████    | 61/100 [00:11<00:07,  5.19it/s]Collecting hidden states:  62%|██████▏   | 62/100 [00:11<00:07,  5.04it/s]Collecting hidden states:  63%|██████▎   | 63/100 [00:12<00:09,  4.01it/s]Collecting hidden states:  64%|██████▍   | 64/100 [00:12<00:08,  4.06it/s]Collecting hidden states:  65%|██████▌   | 65/100 [00:12<00:09,  3.85it/s]Collecting hidden states:  66%|██████▌   | 66/100 [00:12<00:07,  4.50it/s]Collecting hidden states:  67%|██████▋   | 67/100 [00:12<00:07,  4.45it/s]Collecting hidden states:  68%|██████▊   | 68/100 [00:13<00:07,  4.49it/s]Collecting hidden states:  69%|██████▉   | 69/100 [00:13<00:08,  3.71it/s]Collecting hidden states:  70%|███████   | 70/100 [00:13<00:07,  4.27it/s]Collecting hidden states:  71%|███████   | 71/100 [00:13<00:06,  4.76it/s]Collecting hidden states:  72%|███████▏  | 72/100 [00:14<00:06,  4.66it/s]Collecting hidden states:  73%|███████▎  | 73/100 [00:14<00:05,  5.00it/s]Collecting hidden states:  74%|███████▍  | 74/100 [00:14<00:06,  4.23it/s]Collecting hidden states:  75%|███████▌  | 75/100 [00:14<00:05,  4.74it/s]Collecting hidden states:  76%|███████▌  | 76/100 [00:14<00:04,  5.19it/s]Collecting hidden states:  77%|███████▋  | 77/100 [00:14<00:04,  5.68it/s]Collecting hidden states:  78%|███████▊  | 78/100 [00:15<00:04,  4.97it/s]Collecting hidden states:  79%|███████▉  | 79/100 [00:15<00:03,  5.49it/s]Collecting hidden states:  80%|████████  | 80/100 [00:15<00:05,  3.93it/s]Collecting hidden states:  81%|████████  | 81/100 [00:16<00:04,  4.03it/s]Collecting hidden states:  82%|████████▏ | 82/100 [00:16<00:03,  4.53it/s]Collecting hidden states:  83%|████████▎ | 83/100 [00:16<00:03,  5.14it/s]Collecting hidden states:  84%|████████▍ | 84/100 [00:16<00:02,  5.49it/s]Collecting hidden states:  85%|████████▌ | 85/100 [00:16<00:02,  5.80it/s]Collecting hidden states:  86%|████████▌ | 86/100 [00:16<00:02,  5.02it/s]Collecting hidden states:  87%|████████▋ | 87/100 [00:17<00:02,  5.63it/s]Collecting hidden states:  88%|████████▊ | 88/100 [00:17<00:02,  5.12it/s]Collecting hidden states:  89%|████████▉ | 89/100 [00:17<00:02,  5.47it/s]Collecting hidden states:  90%|█████████ | 90/100 [00:17<00:01,  5.72it/s]Collecting hidden states:  91%|█████████ | 91/100 [00:17<00:01,  6.18it/s]Collecting hidden states:  92%|█████████▏| 92/100 [00:17<00:01,  6.27it/s]Collecting hidden states:  93%|█████████▎| 93/100 [00:17<00:01,  6.64it/s]Collecting hidden states:  94%|█████████▍| 94/100 [00:18<00:01,  5.17it/s]Collecting hidden states:  95%|█████████▌| 95/100 [00:18<00:00,  5.53it/s]Collecting hidden states:  96%|█████████▌| 96/100 [00:18<00:00,  5.81it/s]Collecting hidden states:  97%|█████████▋| 97/100 [00:18<00:00,  4.77it/s]Collecting hidden states:  98%|█████████▊| 98/100 [00:19<00:00,  5.37it/s]Collecting hidden states:  99%|█████████▉| 99/100 [00:19<00:00,  5.64it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  6.07it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  5.18it/s]
2025-12-11 17:29:01,675 | INFO | Collected 100 wrong embeddings with steering (shape: (100, 4096))
2025-12-11 17:29:01,809 | INFO | Shift statistics:
2025-12-11 17:29:01,810 | INFO |   Steering shift - Mean L2: 19.0103
2025-12-11 17:29:01,810 | INFO |   Distance to correct (before) - Mean L2: 12.6953
2025-12-11 17:29:01,810 | INFO |   Distance to correct (after) - Mean L2: 22.8634
2025-12-11 17:29:01,810 | INFO |   Improvement - Mean L2 reduction: -10.1670
2025-12-11 17:29:01,811 | INFO | Advanced Metrics:
2025-12-11 17:29:01,811 | INFO |   Projected Shift (Useful):   0.2135
2025-12-11 17:29:01,811 | INFO |   Orthogonal Shift (Useless): 19.0091
2025-12-11 17:29:01,811 | INFO |   Shift Ratio (Proj/Total):   0.0112
2025-12-11 17:29:01,811 | INFO |   Recovery Score:             -0.8485 (1.0 = perfect, 0.0 = no change)
2025-12-11 17:29:01,811 | INFO |   Positive Recovery %:        0.0%
2025-12-11 17:29:01,811 | INFO | Saved statistics to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample/layer29_shift_statistics_offset0.json
2025-12-11 17:29:01,812 | INFO | Creating visualizations...
2025-12-11 17:29:02,765 | INFO | Saved comparison plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample/layer29_pca_comparison_offset0.png
2025-12-11 17:29:03,280 | INFO | Saved overlay plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample/layer29_pca_overlay_offset0.png
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/numba/np/ufunc/parallel.py:373: NumbaWarning: The TBB threading layer requires TBB version 2021 update 6 or later i.e., TBB_INTERFACE_VERSION >= 12060. Found TBB_INTERFACE_VERSION = 12050. The TBB threading layer is disabled.
  warnings.warn(problem)
2025-12-11 17:29:15,710 | INFO | Saved comparison plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample/layer29_umap_comparison_offset0.png
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
2025-12-11 17:29:22,149 | INFO | Saved overlay plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample/layer29_umap_overlay_offset0.png
2025-12-11 17:29:22,149 | INFO | All visualizations saved to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/transformers/utils/hub.py:127: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
2025-12-11 17:29:33,157 | INFO | Loaded 100 triples for comparison
2025-12-11 17:29:33,158 | INFO | Loaded steering vector for layer 29 (shape: (4096,), norm: 19.0103)
2025-12-11 17:29:33,202 | INFO | Loading model meta-llama/Llama-3.1-8B-Instruct on cuda with dtype torch.float16
Downloading shards:   0%|          | 0/4 [00:00<?, ?it/s]Downloading shards: 100%|██████████| 4/4 [00:00<00:00, 13651.11it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:07,  2.39s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.41s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:07<00:02,  2.38s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.70s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.96s/it]
2025-12-11 17:29:43,566 | INFO | Collecting correct embeddings (prompt + correct_chain)... [offset=100, max=100]
Collecting hidden states:   0%|          | 0/100 [00:00<?, ?it/s]Collecting hidden states:   1%|          | 1/100 [00:01<02:33,  1.56s/it]Collecting hidden states:   2%|▏         | 2/100 [00:01<01:14,  1.32it/s]Collecting hidden states:   3%|▎         | 3/100 [00:02<00:52,  1.85it/s]Collecting hidden states:   4%|▍         | 4/100 [00:02<00:42,  2.26it/s]Collecting hidden states:   5%|▌         | 5/100 [00:02<00:33,  2.87it/s]Collecting hidden states:   6%|▌         | 6/100 [00:02<00:26,  3.50it/s]Collecting hidden states:   7%|▋         | 7/100 [00:03<00:34,  2.73it/s]Collecting hidden states:   8%|▊         | 8/100 [00:03<00:27,  3.34it/s]Collecting hidden states:   9%|▉         | 9/100 [00:03<00:30,  2.96it/s]Collecting hidden states:  10%|█         | 10/100 [00:04<00:27,  3.30it/s]Collecting hidden states:  11%|█         | 11/100 [00:04<00:26,  3.34it/s]Collecting hidden states:  12%|█▏        | 12/100 [00:04<00:26,  3.28it/s]Collecting hidden states:  13%|█▎        | 13/100 [00:04<00:28,  3.09it/s]Collecting hidden states:  14%|█▍        | 14/100 [00:05<00:24,  3.57it/s]Collecting hidden states:  15%|█▌        | 15/100 [00:05<00:21,  4.01it/s]Collecting hidden states:  16%|█▌        | 16/100 [00:05<00:21,  3.84it/s]Collecting hidden states:  17%|█▋        | 17/100 [00:05<00:23,  3.47it/s]Collecting hidden states:  18%|█▊        | 18/100 [00:06<00:22,  3.71it/s]Collecting hidden states:  19%|█▉        | 19/100 [00:06<00:20,  3.90it/s]Collecting hidden states:  20%|██        | 20/100 [00:06<00:21,  3.68it/s]Collecting hidden states:  21%|██        | 21/100 [00:07<00:22,  3.51it/s]Collecting hidden states:  22%|██▏       | 22/100 [00:07<00:24,  3.20it/s]Collecting hidden states:  23%|██▎       | 23/100 [00:07<00:21,  3.57it/s]Collecting hidden states:  24%|██▍       | 24/100 [00:08<00:27,  2.76it/s]Collecting hidden states:  25%|██▌       | 25/100 [00:08<00:23,  3.13it/s]Collecting hidden states:  26%|██▌       | 26/100 [00:09<00:38,  1.91it/s]Collecting hidden states:  27%|██▋       | 27/100 [00:09<00:29,  2.45it/s]Collecting hidden states:  28%|██▊       | 28/100 [00:09<00:29,  2.47it/s]Collecting hidden states:  29%|██▉       | 29/100 [00:10<00:24,  2.93it/s]Collecting hidden states:  30%|███       | 30/100 [00:10<00:20,  3.41it/s]Collecting hidden states:  31%|███       | 31/100 [00:10<00:21,  3.22it/s]Collecting hidden states:  32%|███▏      | 32/100 [00:10<00:19,  3.56it/s]Collecting hidden states:  33%|███▎      | 33/100 [00:11<00:19,  3.51it/s]Collecting hidden states:  34%|███▍      | 34/100 [00:11<00:20,  3.26it/s]Collecting hidden states:  35%|███▌      | 35/100 [00:11<00:16,  3.97it/s]Collecting hidden states:  36%|███▌      | 36/100 [00:12<00:19,  3.28it/s]Collecting hidden states:  37%|███▋      | 37/100 [00:12<00:19,  3.27it/s]Collecting hidden states:  38%|███▊      | 38/100 [00:12<00:20,  3.00it/s]Collecting hidden states:  39%|███▉      | 39/100 [00:13<00:26,  2.27it/s]Collecting hidden states:  40%|████      | 40/100 [00:13<00:22,  2.71it/s]Collecting hidden states:  41%|████      | 41/100 [00:13<00:18,  3.11it/s]Collecting hidden states:  42%|████▏     | 42/100 [00:14<00:22,  2.60it/s]Collecting hidden states:  43%|████▎     | 43/100 [00:14<00:18,  3.00it/s]Collecting hidden states:  44%|████▍     | 44/100 [00:15<00:19,  2.88it/s]Collecting hidden states:  45%|████▌     | 45/100 [00:15<00:26,  2.10it/s]Collecting hidden states:  46%|████▌     | 46/100 [00:16<00:30,  1.79it/s]Collecting hidden states:  47%|████▋     | 47/100 [00:16<00:24,  2.18it/s]Collecting hidden states:  48%|████▊     | 48/100 [00:16<00:19,  2.72it/s]Collecting hidden states:  49%|████▉     | 49/100 [00:17<00:17,  2.90it/s]Collecting hidden states:  50%|█████     | 50/100 [00:17<00:17,  2.79it/s]Collecting hidden states:  51%|█████     | 51/100 [00:17<00:17,  2.75it/s]Collecting hidden states:  52%|█████▏    | 52/100 [00:18<00:15,  3.05it/s]Collecting hidden states:  53%|█████▎    | 53/100 [00:18<00:15,  3.09it/s]Collecting hidden states:  54%|█████▍    | 54/100 [00:18<00:15,  2.94it/s]Collecting hidden states:  55%|█████▌    | 55/100 [00:19<00:15,  2.85it/s]Collecting hidden states:  56%|█████▌    | 56/100 [00:19<00:15,  2.75it/s]Collecting hidden states:  57%|█████▋    | 57/100 [00:20<00:16,  2.65it/s]Collecting hidden states:  58%|█████▊    | 58/100 [00:21<00:22,  1.83it/s]Collecting hidden states:  59%|█████▉    | 59/100 [00:21<00:18,  2.24it/s]Collecting hidden states:  60%|██████    | 60/100 [00:21<00:15,  2.51it/s]Collecting hidden states:  61%|██████    | 61/100 [00:21<00:13,  2.93it/s]Collecting hidden states:  62%|██████▏   | 62/100 [00:21<00:11,  3.30it/s]Collecting hidden states:  63%|██████▎   | 63/100 [00:22<00:11,  3.18it/s]Collecting hidden states:  64%|██████▍   | 64/100 [00:23<00:17,  2.08it/s]Collecting hidden states:  65%|██████▌   | 65/100 [00:23<00:14,  2.38it/s]Collecting hidden states:  66%|██████▌   | 66/100 [00:23<00:11,  2.95it/s]Collecting hidden states:  67%|██████▋   | 67/100 [00:23<00:09,  3.57it/s]Collecting hidden states:  68%|██████▊   | 68/100 [00:23<00:07,  4.16it/s]Collecting hidden states:  69%|██████▉   | 69/100 [00:24<00:07,  4.31it/s]Collecting hidden states:  70%|███████   | 70/100 [00:24<00:06,  4.40it/s]Collecting hidden states:  71%|███████   | 71/100 [00:24<00:06,  4.14it/s]Collecting hidden states:  72%|███████▏  | 72/100 [00:24<00:07,  3.59it/s]Collecting hidden states:  73%|███████▎  | 73/100 [00:25<00:07,  3.84it/s]Collecting hidden states:  74%|███████▍  | 74/100 [00:25<00:07,  3.40it/s]Collecting hidden states:  75%|███████▌  | 75/100 [00:26<00:13,  1.88it/s]Collecting hidden states:  76%|███████▌  | 76/100 [00:27<00:11,  2.07it/s]Collecting hidden states:  77%|███████▋  | 77/100 [00:27<00:12,  1.91it/s]Collecting hidden states:  78%|███████▊  | 78/100 [00:27<00:09,  2.35it/s]Collecting hidden states:  79%|███████▉  | 79/100 [00:28<00:07,  2.77it/s]Collecting hidden states:  80%|████████  | 80/100 [00:28<00:06,  3.01it/s]Collecting hidden states:  81%|████████  | 81/100 [00:28<00:06,  3.12it/s]Collecting hidden states:  82%|████████▏ | 82/100 [00:28<00:05,  3.24it/s]Collecting hidden states:  83%|████████▎ | 83/100 [00:29<00:04,  3.43it/s]Collecting hidden states:  84%|████████▍ | 84/100 [00:29<00:04,  3.66it/s]Collecting hidden states:  85%|████████▌ | 85/100 [00:29<00:03,  4.36it/s]Collecting hidden states:  86%|████████▌ | 86/100 [00:29<00:03,  3.69it/s]Collecting hidden states:  87%|████████▋ | 87/100 [00:30<00:03,  3.84it/s]Collecting hidden states:  88%|████████▊ | 88/100 [00:30<00:03,  3.40it/s]Collecting hidden states:  89%|████████▉ | 89/100 [00:30<00:03,  3.64it/s]Collecting hidden states:  90%|█████████ | 90/100 [00:30<00:02,  3.51it/s]Collecting hidden states:  91%|█████████ | 91/100 [00:31<00:02,  3.24it/s]Collecting hidden states:  92%|█████████▏| 92/100 [00:31<00:02,  3.69it/s]Collecting hidden states:  93%|█████████▎| 93/100 [00:32<00:02,  2.41it/s]Collecting hidden states:  94%|█████████▍| 94/100 [00:32<00:02,  2.79it/s]Collecting hidden states:  95%|█████████▌| 95/100 [00:32<00:01,  3.37it/s]Collecting hidden states:  96%|█████████▌| 96/100 [00:33<00:01,  3.11it/s]Collecting hidden states:  97%|█████████▋| 97/100 [00:33<00:01,  2.52it/s]Collecting hidden states:  98%|█████████▊| 98/100 [00:33<00:00,  2.84it/s]Collecting hidden states:  99%|█████████▉| 99/100 [00:34<00:00,  2.78it/s]Collecting hidden states: 100%|██████████| 100/100 [00:34<00:00,  3.38it/s]Collecting hidden states: 100%|██████████| 100/100 [00:34<00:00,  2.91it/s]
2025-12-11 17:30:17,971 | INFO | Collected 100 correct embeddings (shape: (100, 4096))
2025-12-11 17:30:17,971 | INFO | Collecting wrong embeddings without steering (prompt only)...
Collecting hidden states:   0%|          | 0/100 [00:00<?, ?it/s]Collecting hidden states:   1%|          | 1/100 [00:00<00:21,  4.61it/s]Collecting hidden states:   2%|▏         | 2/100 [00:00<00:16,  6.10it/s]Collecting hidden states:   3%|▎         | 3/100 [00:00<00:18,  5.23it/s]Collecting hidden states:   4%|▍         | 4/100 [00:00<00:20,  4.78it/s]Collecting hidden states:   5%|▌         | 5/100 [00:00<00:18,  5.14it/s]Collecting hidden states:   6%|▌         | 6/100 [00:01<00:16,  5.79it/s]Collecting hidden states:   7%|▋         | 7/100 [00:01<00:19,  4.66it/s]Collecting hidden states:   9%|▉         | 9/100 [00:01<00:15,  5.89it/s]Collecting hidden states:  10%|█         | 10/100 [00:01<00:14,  6.06it/s]Collecting hidden states:  11%|█         | 11/100 [00:01<00:15,  5.93it/s]Collecting hidden states:  12%|█▏        | 12/100 [00:02<00:14,  6.25it/s]Collecting hidden states:  13%|█▎        | 13/100 [00:02<00:14,  5.92it/s]Collecting hidden states:  14%|█▍        | 14/100 [00:02<00:13,  6.31it/s]Collecting hidden states:  16%|█▌        | 16/100 [00:02<00:13,  6.38it/s]Collecting hidden states:  17%|█▋        | 17/100 [00:02<00:14,  5.85it/s]Collecting hidden states:  18%|█▊        | 18/100 [00:03<00:13,  5.99it/s]Collecting hidden states:  19%|█▉        | 19/100 [00:03<00:12,  6.30it/s]Collecting hidden states:  20%|██        | 20/100 [00:03<00:14,  5.62it/s]Collecting hidden states:  21%|██        | 21/100 [00:03<00:13,  5.75it/s]Collecting hidden states:  22%|██▏       | 22/100 [00:03<00:13,  5.92it/s]Collecting hidden states:  23%|██▎       | 23/100 [00:03<00:12,  6.33it/s]Collecting hidden states:  24%|██▍       | 24/100 [00:04<00:11,  6.39it/s]Collecting hidden states:  25%|██▌       | 25/100 [00:04<00:11,  6.49it/s]Collecting hidden states:  26%|██▌       | 26/100 [00:04<00:18,  3.94it/s]Collecting hidden states:  27%|██▋       | 27/100 [00:04<00:16,  4.48it/s]Collecting hidden states:  28%|██▊       | 28/100 [00:05<00:16,  4.49it/s]Collecting hidden states:  29%|██▉       | 29/100 [00:05<00:14,  4.92it/s]Collecting hidden states:  30%|███       | 30/100 [00:05<00:12,  5.47it/s]Collecting hidden states:  31%|███       | 31/100 [00:05<00:12,  5.71it/s]Collecting hidden states:  32%|███▏      | 32/100 [00:05<00:11,  6.03it/s]Collecting hidden states:  33%|███▎      | 33/100 [00:05<00:13,  4.93it/s]Collecting hidden states:  34%|███▍      | 34/100 [00:06<00:13,  4.81it/s]Collecting hidden states:  35%|███▌      | 35/100 [00:06<00:12,  5.36it/s]Collecting hidden states:  36%|███▌      | 36/100 [00:06<00:11,  5.62it/s]Collecting hidden states:  37%|███▋      | 37/100 [00:06<00:10,  5.79it/s]Collecting hidden states:  38%|███▊      | 38/100 [00:06<00:10,  5.79it/s]Collecting hidden states:  39%|███▉      | 39/100 [00:07<00:11,  5.33it/s]Collecting hidden states:  40%|████      | 40/100 [00:07<00:10,  5.83it/s]Collecting hidden states:  41%|████      | 41/100 [00:07<00:09,  5.94it/s]Collecting hidden states:  42%|████▏     | 42/100 [00:07<00:11,  4.93it/s]Collecting hidden states:  43%|████▎     | 43/100 [00:07<00:10,  5.33it/s]Collecting hidden states:  44%|████▍     | 44/100 [00:07<00:10,  5.56it/s]Collecting hidden states:  45%|████▌     | 45/100 [00:08<00:10,  5.22it/s]Collecting hidden states:  46%|████▌     | 46/100 [00:08<00:11,  4.90it/s]Collecting hidden states:  47%|████▋     | 47/100 [00:08<00:09,  5.46it/s]Collecting hidden states:  49%|████▉     | 49/100 [00:08<00:08,  5.85it/s]Collecting hidden states:  50%|█████     | 50/100 [00:09<00:10,  4.89it/s]Collecting hidden states:  51%|█████     | 51/100 [00:09<00:09,  5.24it/s]Collecting hidden states:  52%|█████▏    | 52/100 [00:09<00:08,  5.70it/s]Collecting hidden states:  53%|█████▎    | 53/100 [00:09<00:08,  5.87it/s]Collecting hidden states:  54%|█████▍    | 54/100 [00:09<00:07,  5.86it/s]Collecting hidden states:  55%|█████▌    | 55/100 [00:09<00:07,  6.16it/s]Collecting hidden states:  56%|█████▌    | 56/100 [00:10<00:09,  4.84it/s]Collecting hidden states:  57%|█████▋    | 57/100 [00:10<00:10,  4.19it/s]Collecting hidden states:  58%|█████▊    | 58/100 [00:10<00:09,  4.66it/s]Collecting hidden states:  59%|█████▉    | 59/100 [00:10<00:08,  4.60it/s]Collecting hidden states:  60%|██████    | 60/100 [00:11<00:09,  4.34it/s]Collecting hidden states:  61%|██████    | 61/100 [00:11<00:08,  4.65it/s]Collecting hidden states:  62%|██████▏   | 62/100 [00:11<00:07,  4.89it/s]Collecting hidden states:  63%|██████▎   | 63/100 [00:11<00:06,  5.32it/s]Collecting hidden states:  64%|██████▍   | 64/100 [00:11<00:06,  5.40it/s]Collecting hidden states:  65%|██████▌   | 65/100 [00:11<00:05,  5.91it/s]Collecting hidden states:  66%|██████▌   | 66/100 [00:12<00:05,  6.25it/s]Collecting hidden states:  67%|██████▋   | 67/100 [00:12<00:04,  6.64it/s]Collecting hidden states:  68%|██████▊   | 68/100 [00:12<00:04,  6.87it/s]Collecting hidden states:  69%|██████▉   | 69/100 [00:12<00:04,  7.03it/s]Collecting hidden states:  70%|███████   | 70/100 [00:12<00:04,  6.88it/s]Collecting hidden states:  71%|███████   | 71/100 [00:12<00:04,  6.85it/s]Collecting hidden states:  72%|███████▏  | 72/100 [00:13<00:05,  5.25it/s]Collecting hidden states:  73%|███████▎  | 73/100 [00:13<00:04,  5.62it/s]Collecting hidden states:  74%|███████▍  | 74/100 [00:13<00:05,  5.16it/s]Collecting hidden states:  75%|███████▌  | 75/100 [00:13<00:06,  3.78it/s]Collecting hidden states:  76%|███████▌  | 76/100 [00:14<00:06,  3.62it/s]Collecting hidden states:  77%|███████▋  | 77/100 [00:14<00:05,  4.31it/s]Collecting hidden states:  78%|███████▊  | 78/100 [00:14<00:05,  4.33it/s]Collecting hidden states:  79%|███████▉  | 79/100 [00:14<00:04,  4.85it/s]Collecting hidden states:  80%|████████  | 80/100 [00:14<00:03,  5.21it/s]Collecting hidden states:  81%|████████  | 81/100 [00:15<00:03,  4.98it/s]Collecting hidden states:  82%|████████▏ | 82/100 [00:15<00:03,  4.83it/s]Collecting hidden states:  83%|████████▎ | 83/100 [00:15<00:03,  5.44it/s]Collecting hidden states:  84%|████████▍ | 84/100 [00:15<00:03,  5.14it/s]Collecting hidden states:  85%|████████▌ | 85/100 [00:15<00:02,  5.69it/s]Collecting hidden states:  86%|████████▌ | 86/100 [00:16<00:02,  4.71it/s]Collecting hidden states:  87%|████████▋ | 87/100 [00:16<00:02,  5.29it/s]Collecting hidden states:  88%|████████▊ | 88/100 [00:16<00:02,  4.32it/s]Collecting hidden states:  89%|████████▉ | 89/100 [00:16<00:02,  4.04it/s]Collecting hidden states:  90%|█████████ | 90/100 [00:17<00:02,  4.18it/s]Collecting hidden states:  91%|█████████ | 91/100 [00:17<00:01,  4.64it/s]Collecting hidden states:  92%|█████████▏| 92/100 [00:17<00:01,  5.51it/s]Collecting hidden states:  93%|█████████▎| 93/100 [00:17<00:02,  3.44it/s]Collecting hidden states:  94%|█████████▍| 94/100 [00:18<00:01,  3.90it/s]Collecting hidden states:  95%|█████████▌| 95/100 [00:18<00:01,  4.31it/s]Collecting hidden states:  96%|█████████▌| 96/100 [00:18<00:00,  4.35it/s]Collecting hidden states:  97%|█████████▋| 97/100 [00:18<00:00,  4.96it/s]Collecting hidden states:  98%|█████████▊| 98/100 [00:18<00:00,  5.51it/s]Collecting hidden states:  99%|█████████▉| 99/100 [00:18<00:00,  5.13it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  5.55it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  5.23it/s]
2025-12-11 17:30:37,095 | INFO | Collected 100 wrong embeddings without steering (shape: (100, 4096))
2025-12-11 17:30:37,095 | INFO | Collecting wrong embeddings with steering (simulated by adding steering vector)...
Collecting hidden states:   0%|          | 0/100 [00:00<?, ?it/s]Collecting hidden states:   1%|          | 1/100 [00:00<00:25,  3.91it/s]Collecting hidden states:   2%|▏         | 2/100 [00:00<00:19,  4.91it/s]Collecting hidden states:   3%|▎         | 3/100 [00:00<00:22,  4.31it/s]Collecting hidden states:   4%|▍         | 4/100 [00:00<00:21,  4.55it/s]Collecting hidden states:   5%|▌         | 5/100 [00:00<00:17,  5.55it/s]Collecting hidden states:   6%|▌         | 6/100 [00:01<00:15,  5.97it/s]Collecting hidden states:   7%|▋         | 7/100 [00:01<00:19,  4.86it/s]Collecting hidden states:   8%|▊         | 8/100 [00:01<00:16,  5.68it/s]Collecting hidden states:   9%|▉         | 9/100 [00:01<00:15,  5.99it/s]Collecting hidden states:  10%|█         | 10/100 [00:01<00:15,  5.91it/s]Collecting hidden states:  11%|█         | 11/100 [00:02<00:15,  5.71it/s]Collecting hidden states:  12%|█▏        | 12/100 [00:02<00:13,  6.37it/s]Collecting hidden states:  13%|█▎        | 13/100 [00:02<00:13,  6.64it/s]Collecting hidden states:  14%|█▍        | 14/100 [00:02<00:12,  6.83it/s]Collecting hidden states:  15%|█▌        | 15/100 [00:02<00:11,  7.36it/s]Collecting hidden states:  16%|█▌        | 16/100 [00:02<00:14,  5.81it/s]Collecting hidden states:  17%|█▋        | 17/100 [00:03<00:15,  5.26it/s]Collecting hidden states:  18%|█▊        | 18/100 [00:03<00:14,  5.74it/s]Collecting hidden states:  19%|█▉        | 19/100 [00:03<00:14,  5.68it/s]Collecting hidden states:  20%|██        | 20/100 [00:03<00:15,  5.33it/s]Collecting hidden states:  21%|██        | 21/100 [00:03<00:14,  5.54it/s]Collecting hidden states:  22%|██▏       | 22/100 [00:03<00:14,  5.41it/s]Collecting hidden states:  23%|██▎       | 23/100 [00:04<00:13,  5.92it/s]Collecting hidden states:  24%|██▍       | 24/100 [00:04<00:13,  5.66it/s]Collecting hidden states:  25%|██▌       | 25/100 [00:04<00:13,  5.54it/s]Collecting hidden states:  26%|██▌       | 26/100 [00:04<00:18,  3.98it/s]Collecting hidden states:  27%|██▋       | 27/100 [00:05<00:17,  4.29it/s]Collecting hidden states:  28%|██▊       | 28/100 [00:05<00:16,  4.41it/s]Collecting hidden states:  29%|██▉       | 29/100 [00:05<00:14,  5.06it/s]Collecting hidden states:  30%|███       | 30/100 [00:05<00:12,  5.60it/s]Collecting hidden states:  31%|███       | 31/100 [00:05<00:11,  5.93it/s]Collecting hidden states:  32%|███▏      | 32/100 [00:05<00:10,  6.33it/s]Collecting hidden states:  33%|███▎      | 33/100 [00:06<00:12,  5.27it/s]Collecting hidden states:  34%|███▍      | 34/100 [00:06<00:13,  5.02it/s]Collecting hidden states:  35%|███▌      | 35/100 [00:06<00:11,  5.62it/s]Collecting hidden states:  36%|███▌      | 36/100 [00:06<00:10,  5.92it/s]Collecting hidden states:  37%|███▋      | 37/100 [00:06<00:10,  5.86it/s]Collecting hidden states:  38%|███▊      | 38/100 [00:06<00:10,  6.02it/s]Collecting hidden states:  39%|███▉      | 39/100 [00:07<00:11,  5.42it/s]Collecting hidden states:  40%|████      | 40/100 [00:07<00:10,  5.59it/s]Collecting hidden states:  41%|████      | 41/100 [00:07<00:09,  5.91it/s]Collecting hidden states:  42%|████▏     | 42/100 [00:07<00:11,  5.24it/s]Collecting hidden states:  43%|████▎     | 43/100 [00:07<00:10,  5.43it/s]Collecting hidden states:  44%|████▍     | 44/100 [00:08<00:09,  5.68it/s]Collecting hidden states:  45%|████▌     | 45/100 [00:08<00:11,  4.91it/s]Collecting hidden states:  46%|████▌     | 46/100 [00:08<00:11,  4.80it/s]Collecting hidden states:  47%|████▋     | 47/100 [00:08<00:09,  5.40it/s]Collecting hidden states:  49%|████▉     | 49/100 [00:08<00:09,  5.37it/s]Collecting hidden states:  50%|█████     | 50/100 [00:09<00:11,  4.46it/s]Collecting hidden states:  51%|█████     | 51/100 [00:09<00:10,  4.48it/s]Collecting hidden states:  52%|█████▏    | 52/100 [00:09<00:09,  5.12it/s]Collecting hidden states:  53%|█████▎    | 53/100 [00:09<00:08,  5.48it/s]Collecting hidden states:  54%|█████▍    | 54/100 [00:10<00:08,  5.38it/s]Collecting hidden states:  55%|█████▌    | 55/100 [00:10<00:07,  5.87it/s]Collecting hidden states:  56%|█████▌    | 56/100 [00:10<00:08,  4.90it/s]Collecting hidden states:  57%|█████▋    | 57/100 [00:10<00:09,  4.33it/s]Collecting hidden states:  58%|█████▊    | 58/100 [00:10<00:08,  4.76it/s]Collecting hidden states:  59%|█████▉    | 59/100 [00:11<00:09,  4.49it/s]Collecting hidden states:  60%|██████    | 60/100 [00:11<00:08,  4.50it/s]Collecting hidden states:  61%|██████    | 61/100 [00:11<00:08,  4.76it/s]Collecting hidden states:  62%|██████▏   | 62/100 [00:11<00:07,  4.88it/s]Collecting hidden states:  63%|██████▎   | 63/100 [00:11<00:07,  4.99it/s]Collecting hidden states:  64%|██████▍   | 64/100 [00:12<00:06,  5.46it/s]Collecting hidden states:  65%|██████▌   | 65/100 [00:12<00:05,  6.13it/s]Collecting hidden states:  66%|██████▌   | 66/100 [00:12<00:05,  6.00it/s]Collecting hidden states:  67%|██████▋   | 67/100 [00:12<00:05,  6.43it/s]Collecting hidden states:  68%|██████▊   | 68/100 [00:12<00:05,  6.29it/s]Collecting hidden states:  69%|██████▉   | 69/100 [00:12<00:05,  6.18it/s]Collecting hidden states:  70%|███████   | 70/100 [00:13<00:04,  6.08it/s]Collecting hidden states:  71%|███████   | 71/100 [00:13<00:04,  6.46it/s]Collecting hidden states:  72%|███████▏  | 72/100 [00:13<00:05,  5.29it/s]Collecting hidden states:  73%|███████▎  | 73/100 [00:13<00:04,  5.66it/s]Collecting hidden states:  74%|███████▍  | 74/100 [00:13<00:05,  5.16it/s]Collecting hidden states:  75%|███████▌  | 75/100 [00:14<00:06,  3.95it/s]Collecting hidden states:  76%|███████▌  | 76/100 [00:14<00:06,  3.51it/s]Collecting hidden states:  77%|███████▋  | 77/100 [00:14<00:05,  4.19it/s]Collecting hidden states:  78%|███████▊  | 78/100 [00:14<00:04,  4.49it/s]Collecting hidden states:  79%|███████▉  | 79/100 [00:14<00:04,  5.07it/s]Collecting hidden states:  80%|████████  | 80/100 [00:15<00:03,  5.43it/s]Collecting hidden states:  81%|████████  | 81/100 [00:15<00:03,  5.41it/s]Collecting hidden states:  82%|████████▏ | 82/100 [00:15<00:03,  5.43it/s]Collecting hidden states:  83%|████████▎ | 83/100 [00:15<00:02,  6.24it/s]Collecting hidden states:  84%|████████▍ | 84/100 [00:15<00:02,  5.63it/s]Collecting hidden states:  85%|████████▌ | 85/100 [00:15<00:02,  6.35it/s]Collecting hidden states:  86%|████████▌ | 86/100 [00:16<00:02,  5.35it/s]Collecting hidden states:  87%|████████▋ | 87/100 [00:16<00:02,  6.04it/s]Collecting hidden states:  88%|████████▊ | 88/100 [00:16<00:02,  4.90it/s]Collecting hidden states:  89%|████████▉ | 89/100 [00:16<00:02,  4.80it/s]Collecting hidden states:  90%|█████████ | 90/100 [00:17<00:02,  4.71it/s]Collecting hidden states:  91%|█████████ | 91/100 [00:17<00:01,  5.10it/s]Collecting hidden states:  93%|█████████▎| 93/100 [00:17<00:01,  4.02it/s]Collecting hidden states:  94%|█████████▍| 94/100 [00:17<00:01,  4.49it/s]Collecting hidden states:  95%|█████████▌| 95/100 [00:18<00:00,  5.04it/s]Collecting hidden states:  96%|█████████▌| 96/100 [00:18<00:00,  4.58it/s]Collecting hidden states:  97%|█████████▋| 97/100 [00:18<00:00,  5.02it/s]Collecting hidden states:  98%|█████████▊| 98/100 [00:18<00:00,  5.43it/s]Collecting hidden states:  99%|█████████▉| 99/100 [00:18<00:00,  4.96it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  5.24it/s]Collecting hidden states: 100%|██████████| 100/100 [00:19<00:00,  5.24it/s]
2025-12-11 17:30:56,176 | INFO | Collected 100 wrong embeddings with steering (shape: (100, 4096))
2025-12-11 17:30:56,246 | INFO | Shift statistics:
2025-12-11 17:30:56,246 | INFO |   Steering shift - Mean L2: 19.0103
2025-12-11 17:30:56,247 | INFO |   Distance to correct (before) - Mean L2: 5.7891
2025-12-11 17:30:56,247 | INFO |   Distance to correct (after) - Mean L2: 20.0125
2025-12-11 17:30:56,247 | INFO |   Improvement - Mean L2 reduction: -14.2243
2025-12-11 17:30:56,247 | INFO | Advanced Metrics:
2025-12-11 17:30:56,247 | INFO |   Projected Shift (Useful):   0.0974
2025-12-11 17:30:56,247 | INFO |   Orthogonal Shift (Useless): 19.0100
2025-12-11 17:30:56,247 | INFO |   Shift Ratio (Proj/Total):   0.0051
2025-12-11 17:30:56,247 | INFO |   Recovery Score:             -3.3213 (1.0 = perfect, 0.0 = no change)
2025-12-11 17:30:56,247 | INFO |   Positive Recovery %:        0.0%
2025-12-11 17:30:56,247 | INFO | Saved statistics to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample/layer29_shift_statistics_offset100.json
2025-12-11 17:30:56,248 | INFO | Creating visualizations...
2025-12-11 17:30:57,051 | INFO | Saved comparison plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample/layer29_pca_comparison_offset100.png
2025-12-11 17:30:57,513 | INFO | Saved overlay plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample/layer29_pca_overlay_offset100.png
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/numba/np/ufunc/parallel.py:373: NumbaWarning: The TBB threading layer requires TBB version 2021 update 6 or later i.e., TBB_INTERFACE_VERSION >= 12060. Found TBB_INTERFACE_VERSION = 12050. The TBB threading layer is disabled.
  warnings.warn(problem)
2025-12-11 17:31:09,848 | INFO | Saved comparison plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample/layer29_umap_comparison_offset100.png
/u/b/d/bdeka/miniconda3/envs/steering/lib/python3.10/site-packages/umap/umap_.py:1952: UserWarning: n_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.
  warn(
2025-12-11 17:31:15,734 | INFO | Saved overlay plot to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample/layer29_umap_overlay_offset100.png
2025-12-11 17:31:15,734 | INFO | All visualizations saved to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample
Embedding comparison complete. Results saved to /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample and /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample

=== Done! ===
Results:
  - Triples source: ./artifacts/manual_review/12062025_human_review.json
  - Train offset: 0, Eval offset: 100
  - Hidden states: /nobackup/bdeka/huggingface_cache/artifacts/hidden_states/
  - Alignments: /nobackup/bdeka/huggingface_cache/artifacts/alignments/
  - Probe data: /nobackup/bdeka/huggingface_cache/artifacts/probe_data/
  - Computed probes: /nobackup/bdeka/huggingface_cache/artifacts/probe_analysis/
  - Visualizations: /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token/
  - Steering vectors: /nobackup/bdeka/huggingface_cache/artifacts/steering_vectors/
  - Steering evaluation (in-sample): /nobackup/bdeka/huggingface_cache/artifacts/steering_evaluation_in_sample/
  - Steering evaluation (out-of-sample): /nobackup/bdeka/huggingface_cache/artifacts/steering_evaluation_out_of_sample/
  - Embedding comparison (in-sample): /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample/
  - Embedding comparison (out-of-sample): /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample/

Processed layers: 26 27 28 29 30 31
    Extracted HF_HOME from log output path: /nobackup/bdeka/huggingface_cache
    Using HF_HOME: /nobackup/bdeka/huggingface_cache
    Creating HF_HOME images directory: /nobackup/bdeka/huggingface_cache/experiments/20251211_144418/POOLING_METHOD_per_token__TOKEN_SELECTION_METHOD_last_token__LAYER_SELECTION_METHOD_fixed__SKIP_HIDDEN_1__SKIP_PROBES_1__SKIP_PLOTS_0__SKIP_CRITICAL_0__SKIP_STEERING_0__SKIP_EVAL_0/images
    ✓ Successfully created HF_HOME images directory: /nobackup/bdeka/huggingface_cache/experiments/20251211_144418/POOLING_METHOD_per_token__TOKEN_SELECTION_METHOD_last_token__LAYER_SELECTION_METHOD_fixed__SKIP_HIDDEN_1__SKIP_PROBES_1__SKIP_PLOTS_0__SKIP_CRITICAL_0__SKIP_STEERING_0__SKIP_EVAL_0/images

=== Copying generated images to experiment directory ===
  Copying generated images to:
    Local: experiments/20251211_144418/POOLING_METHOD_per_token__TOKEN_SELECTION_METHOD_last_token__LAYER_SELECTION_METHOD_fixed__SKIP_HIDDEN_1__SKIP_PROBES_1__SKIP_PLOTS_0__SKIP_CRITICAL_0__SKIP_STEERING_0__SKIP_EVAL_0/images
    HF_HOME: /nobackup/bdeka/huggingface_cache/experiments/20251211_144418/POOLING_METHOD_per_token__TOKEN_SELECTION_METHOD_last_token__LAYER_SELECTION_METHOD_fixed__SKIP_HIDDEN_1__SKIP_PROBES_1__SKIP_PLOTS_0__SKIP_CRITICAL_0__SKIP_STEERING_0__SKIP_EVAL_0/images
    Source HF_HOME: /nobackup/bdeka/huggingface_cache
    Checking for Step 4 images in: /nobackup/bdeka/huggingface_cache/reports/hidden_state_viz_per_token
    ✓ Copied 12 image(s) from Step 4 (probe visualizations)
    Checking for Step 5 images in: /nobackup/bdeka/huggingface_cache/reports/critical_tokens_per_token
    ✓ Copied 6 image(s) from Step 5 (critical tokens)
    Checking for Step 8 images in:
      HF_HOME: /nobackup/bdeka/huggingface_cache
      In-sample dir: /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_in_sample
      Out-of-sample dir: /nobackup/bdeka/huggingface_cache/reports/steering_embedding_comparison_out_of_sample
    ✓ Copied 4 image(s) from Step 8 (embedding comparison in-sample)
    ✓ Copied 4 image(s) from Step 8 (embedding comparison out-of-sample)
  ✓ Copied 26 total image(s) to:
    - Local: experiments/20251211_144418/POOLING_METHOD_per_token__TOKEN_SELECTION_METHOD_last_token__LAYER_SELECTION_METHOD_fixed__SKIP_HIDDEN_1__SKIP_PROBES_1__SKIP_PLOTS_0__SKIP_CRITICAL_0__SKIP_STEERING_0__SKIP_EVAL_0/images/
    - HF_HOME: /nobackup/bdeka/huggingface_cache/experiments/20251211_144418/POOLING_METHOD_per_token__TOKEN_SELECTION_METHOD_last_token__LAYER_SELECTION_METHOD_fixed__SKIP_HIDDEN_1__SKIP_PROBES_1__SKIP_PLOTS_0__SKIP_CRITICAL_0__SKIP_STEERING_0__SKIP_EVAL_0/images/
